<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>elasticsearch详解 | 郑东辉的博客网站</title><meta name="keywords" content="elasticesarch"><meta name="author" content="郑东辉"><meta name="copyright" content="郑东辉"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="结构化数据 　　指具有固定格式或有限长度的数据，如数据库，元数据等。对于结构化数据，我们一般都是可以通过关系型数据库（mysql、oracle）的table的方法存储和搜索，也可以建立索引。通过b-tree等数据结构快速搜索数据 非结构化数据　　全文数据，指不定长或无固定格式的数据，如邮件，word等。对于非结构化数据，也即对全文数据的搜索主要有两种方式：顺序扫描法，全文搜索法 顺序扫描法　　我们">
<meta property="og:type" content="article">
<meta property="og:title" content="elasticsearch详解">
<meta property="og:url" content="http://example.com/2024/09/01/es%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="郑东辉的博客网站">
<meta property="og:description" content="结构化数据 　　指具有固定格式或有限长度的数据，如数据库，元数据等。对于结构化数据，我们一般都是可以通过关系型数据库（mysql、oracle）的table的方法存储和搜索，也可以建立索引。通过b-tree等数据结构快速搜索数据 非结构化数据　　全文数据，指不定长或无固定格式的数据，如邮件，word等。对于非结构化数据，也即对全文数据的搜索主要有两种方式：顺序扫描法，全文搜索法 顺序扫描法　　我们">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tse4-mm.cn.bing.net/th/id/OIP-C.JIiB0z5a-wUWnqs2EgK_QgHaEK?rs=1&pid=ImgDetMain">
<meta property="article:published_time" content="2024-09-01T01:00:32.255Z">
<meta property="article:modified_time" content="2024-08-31T16:00:00.000Z">
<meta property="article:author" content="郑东辉">
<meta property="article:tag" content="elasticesarch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tse4-mm.cn.bing.net/th/id/OIP-C.JIiB0z5a-wUWnqs2EgK_QgHaEK?rs=1&pid=ImgDetMain"><link rel="shortcut icon" href="/img/touxiang.jpg"><link rel="canonical" href="http://example.com/2024/09/01/es%E8%AF%A6%E8%A7%A3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'elasticsearch详解',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-01 00:00:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/img/touxiang.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">44</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://tse4-mm.cn.bing.net/th/id/OIP-C.JIiB0z5a-wUWnqs2EgK_QgHaEK?rs=1&amp;pid=ImgDetMain')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">郑东辉的博客网站</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">elasticsearch详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-09-01T01:00:32.255Z" title="发表于 2024-09-01 09:00:32">2024-09-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-31T16:00:00.000Z" title="更新于 2024-09-01 00:00:00">2024-09-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/elasticesarch/">elasticesarch</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>结构化数据</p>
<p>　　指具有固定格式或有限长度的数据，如数据库，元数据等。对于结构化数据，我们一般都是可以通过<strong>关系型数据库</strong>（mysql、oracle）的table的<strong>方法存储和搜索</strong>，也可以建立索引。通过b-tree等数据结构快速搜索数据</p>
<h4 id="非结构化数据"><a href="#非结构化数据" class="headerlink" title="非结构化数据"></a>非结构化数据</h4><p>　　全文数据，指<strong>不定长或无固定格式的数据</strong>，如邮件，word等。对于非结构化数据，也即对全文数据的搜索主要有两种方式：<strong>顺序扫描法，全文搜索法</strong></p>
<h5 id="顺序扫描法"><a href="#顺序扫描法" class="headerlink" title="顺序扫描法"></a>顺序扫描法</h5><p>　　我们可以了解它的大概搜索方式，就是按照顺序扫描的方式查找特定的关键字。比如让你在一篇篮球新闻中，找出“科比”这个名字在那些段落出现过。那你肯定需要从头到尾把文章阅读一遍，然后标出关键字在哪些地方出现过</p>
<p>　　这种方式毋庸置疑是最低效的，如果文章很长，有几万字，等你阅读完这篇新闻找到“科比”这个关键字，那得花多少时间</p>
<h5 id="全文搜索"><a href="#全文搜索" class="headerlink" title="全文搜索"></a>全文搜索</h5><p>　　对非结构化数据进行顺序扫描很慢，我们是否可以进行优化？把非结构化数据想办法弄得有一定结构不就好了嘛？将非结构化数据中的一部分信息提取出来，重新组织，使其变得有一定结构，然后对这些有一定结构的数据进行搜索，从而达到搜索相对较快的目的。这种方式就构成了全文搜索的基本思路。这部分从非结构化数据提取出的然后重新组织的信息，就是索引。</p>
<h4 id="什么是全文搜索引擎"><a href="#什么是全文搜索引擎" class="headerlink" title="什么是全文搜索引擎"></a>什么是全文搜索引擎</h4><p>　　根据百度百科中的定义，全文搜索引擎是目前广泛应用的主流搜索引擎。它的工作原理是计算机索引程序通过扫描文章中的每个词，对每个词建立一个索引，指明该词在文章中出现的次数和位置，当用户查询时，检索程序就根据事先建立的索引进行查找，并将查找的结果反馈给用户。</p>
<h4 id="常见的搜索引擎"><a href="#常见的搜索引擎" class="headerlink" title="常见的搜索引擎"></a>常见的搜索引擎</h4><h5 id="Lucene"><a href="#Lucene" class="headerlink" title="Lucene"></a>Lucene</h5><ul>
<li>Lucene是一个<strong>Java全文搜索引擎</strong>，完全用<strong>Java编写</strong>。lucene<strong>不是一个完整的应用程序</strong>，而是一个代码库和API，可以很容易地用于向应用程序添加搜索功能</li>
<li>通过简单的API提供强大的功能<ul>
<li>可扩展的高性能索引</li>
<li>强大，准确，高效的搜索算法</li>
<li>跨平台解决方案</li>
</ul>
</li>
<li>Apache软件基金会<ul>
<li>在Apache软件基金会提供的开源软件项目的Apache社区的支持</li>
<li>但是Lucene只是一个框架，要充分利用它的功能，需要使用Java，并且在程序中集成Lucene。需要很多的学习了解，才能明白它是如何运行的，熟练运用Lucene确实非常复杂</li>
</ul>
</li>
</ul>
<h5 id="Solr"><a href="#Solr" class="headerlink" title="Solr"></a>Solr</h5><ul>
<li>Solr是一个基于Lucene的Java库构建的开源搜索平台。它以友好的方式提供Apache Lucene的搜索功能。它是一个成熟的产品，拥有强大而广泛的用户社区。它能提供分布式索引，复制，负载均衡以及自动故障转移和恢复。如果它被正确部署然后管理的好，他就能够成为一个高可用，可扩展且容错的搜索引擎</li>
<li>强大功能<ul>
<li>全文搜索</li>
<li>突出</li>
<li>分面搜索</li>
<li>实时索引</li>
<li>动态集群</li>
<li>数据库集成</li>
<li>NoSQL功能和丰富的文档处理</li>
</ul>
</li>
</ul>
<h4 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h4><ul>
<li>ElasticSearch是一个开源，是一个机遇Apache Lucene库构建的Restful搜索引擎</li>
<li>ElasticSearch是Solr之后几年推出的。它提供了一个分布式，多租户能力的全文搜索引擎，具有HTTP Web页面和无架构JSON文档。ElasticSearch的官方客户端提供Java、Php、Ruby、Perl、Python、.Net和JavaScript</li>
<li>主要功能<ul>
<li>分布式搜索</li>
<li>数据分析</li>
<li>分组和聚合</li>
</ul>
</li>
<li>应用场景<ul>
<li>维基百科</li>
<li>Stack Overflow</li>
<li>GitHub</li>
<li>电商网站</li>
<li>日志数据分析</li>
<li>商品价格监控网站</li>
<li>BI系统</li>
<li>站内搜索</li>
<li>篮球论坛</li>
</ul>
</li>
</ul>
<h4 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h4><h5 id="索引-index"><a href="#索引-index" class="headerlink" title="索引(index)"></a>索引(index)</h5><p>　　一个索引可以理解成一个关系型数据库</p>
<h5 id="类型-type"><a href="#类型-type" class="headerlink" title="类型(type)"></a>类型(type)</h5><p>　　一个type就像一类表，比如user表、order表</p>
<p>　　注意</p>
<p>　　　　1、ES 5.X中一个index可以有多种type</p>
<p>　　　　2、ES 6.X中一个index只能有一种type</p>
<p>　　　　3、ES 7.X以后已经移除type这个概念</p>
<h5 id="映射-mapping"><a href="#映射-mapping" class="headerlink" title="映射(mapping)"></a>映射(mapping)</h5><p>　　mapping定义了每个字段的类型等信息。相当于关系型数据库中的表结构</p>
<h5 id="文档-document"><a href="#文档-document" class="headerlink" title="文档(document)"></a>文档(document)</h5><p>　　一个document相当于关系型数据库中的一行记录</p>
<h5 id="字段-field"><a href="#字段-field" class="headerlink" title="字段(field)"></a>字段(field)</h5><p>　　相当于关系型数据库表的字段</p>
<h5 id="集群-cluster"><a href="#集群-cluster" class="headerlink" title="集群(cluster)"></a>集群(cluster)</h5><p>　　集群由一个或多个节点组成，一个集群由一个默认名称“elasticsearch”</p>
<h5 id="节点-node"><a href="#节点-node" class="headerlink" title="节点(node)"></a>节点(node)</h5><p>　　集群的节点，一台机器或者一个进程</p>
<h5 id="分片和副本-shard"><a href="#分片和副本-shard" class="headerlink" title="分片和副本(shard)"></a>分片和副本(shard)</h5><ul>
<li>副本是分片的副本。分片有主分片(primary Shard)和副本分片(replica Shard)之分</li>
<li>一个Index数据在库里被分布在多个主分片中，每个主分片只存放部分数据</li>
<li>每个主分片可以有多个副本，叫副本分片，是主分片的复制</li>
</ul>
<h4 id="RESTful风格的介绍"><a href="#RESTful风格的介绍" class="headerlink" title="RESTful风格的介绍"></a>RESTful风格的介绍</h4><h5 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h5><ul>
<li>RESTful是一种架构的规范与约束、原则，符合这种规范的架构就是RESTful架构</li>
<li>先看REST是什么意思，英文Representational state transfer表述性状态转移，其实就是对资源的标书性状态转移，即通过HTTP动词来实现资源的状态扭转</li>
<li>资源是REST系统的核心概念。所有的设计都是以资源为中心</li>
<li>elasticsearch使用RESTful风格api来设计的</li>
</ul>
<h5 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h5><table>
<thead>
<tr>
<th>action</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>HEAD</td>
<td>只获取某个资源的头部信息</td>
</tr>
<tr>
<td>GET</td>
<td>获取资源</td>
</tr>
<tr>
<td>POST</td>
<td>创建或更新资源</td>
</tr>
<tr>
<td>PUT</td>
<td>创建或更新资源</td>
</tr>
<tr>
<td>DELETE</td>
<td>删除资源</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /user:列出所有的⽤户</span><br><span class="line">POST /user:新建⼀个⽤户</span><br><span class="line">PUT /user:更新某个指定⽤户的信息</span><br><span class="line">DELETE /user/ID:删除指定⽤户</span><br></pre></td></tr></table></figure>

<h4 id="调试工具"><a href="#调试工具" class="headerlink" title="调试工具"></a>调试工具</h4><h5 id="Postman工具-推荐"><a href="#Postman工具-推荐" class="headerlink" title="Postman工具(推荐)"></a>Postman工具(推荐)</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200803221515535-826389706.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200803221515535-826389706.png" alt="img"></a></p>
<h5 id="curl工具"><a href="#curl工具" class="headerlink" title="curl工具"></a>curl工具</h5><p>获取elasticcsearch状态</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -X GET &quot;http://localhost:9200&quot;</span><br></pre></td></tr></table></figure>

<p>新建一个文档</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -X PUT <span class="string">&quot;localhost:9200/xdclass/_doc/1&quot;</span> -H <span class="string">&#x27;Content-Type:</span></span><br><span class="line"><span class="string">application/json&#x27;</span> -d<span class="string">&#x27; &#123;</span></span><br><span class="line"><span class="string">&quot;user&quot; : &quot;louis&quot;,</span></span><br><span class="line"><span class="string">&quot;message&quot; : &quot;louis is good&quot;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>删除一个文档</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -X DELETE <span class="string">&quot;localhost:9200/xdclass/_doc/1&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="索引的使用"><a href="#索引的使用" class="headerlink" title="索引的使用"></a>索引的使用</h4><h5 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200803235912261-597717496.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200803235912261-597717496.png" alt="img"></a></p>
<h5 id="单个获取"><a href="#单个获取" class="headerlink" title="单个获取"></a>单个获取</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804000213069-1051668846.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804000213069-1051668846.png" alt="img"></a></p>
<h5 id="批量获取"><a href="#批量获取" class="headerlink" title="批量获取"></a>批量获取</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804000733214-876948181.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804000733214-876948181.png" alt="img"></a></p>
<h5 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804000402060-819102424.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804000402060-819102424.png" alt="img"></a></p>
<h5 id="获取所有"><a href="#获取所有" class="headerlink" title="获取所有"></a>获取所有</h5><h6 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h6><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804000956566-1868264517.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804000956566-1868264517.png" alt="img"></a></p>
<h6 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h6><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804002255049-1599818844.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804002255049-1599818844.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804002318642-599632936.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804002318642-599632936.png" alt="img"></a></p>
<h5 id="判断索引是否存在-存在，返回200，不存在404"><a href="#判断索引是否存在-存在，返回200，不存在404" class="headerlink" title="判断索引是否存在(存在，返回200，不存在404)"></a>判断索引是否存在(存在，返回200，不存在404)</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804002646359-1259376971.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804002646359-1259376971.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804002739971-678882211.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804002739971-678882211.png" alt="img"></a></p>
<h5 id="关闭索引"><a href="#关闭索引" class="headerlink" title="关闭索引"></a>关闭索引</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804002946144-811161385.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804002946144-811161385.png" alt="img"></a></p>
<p>　　此时再次查询nba时，返回json会多一行</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804003041847-1725755851.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804003041847-1725755851.png" alt="img"></a></p>
<h5 id="打开索引"><a href="#打开索引" class="headerlink" title="打开索引"></a>打开索引</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804004258960-1746810041.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804004258960-1746810041.png" alt="img"></a></p>
<p>　　关闭索引标记消失</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804004346380-1438795611.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804004346380-1438795611.png" alt="img"></a></p>
<h4 id="映射的使用"><a href="#映射的使用" class="headerlink" title="映射的使用"></a>映射的使用</h4><h5 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h5><p>　　定义索引的结构，之前定义一个nba索引，但是没有定义他的结构，我们现在开始建立mapping；</p>
<p>　　<strong>type&#x3D;”keyword”：是一个关键字，不会被分词</strong></p>
<p>　　<strong>type&#x3D;”text”：会被分词，使用的是全文索引</strong></p>
<h5 id="新增-1"><a href="#新增-1" class="headerlink" title="新增"></a>新增</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804235510699-857371099.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804235510699-857371099.png" alt="img"></a></p>
<h5 id="json格式"><a href="#json格式" class="headerlink" title="json格式"></a>json格式</h5><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;team_name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;play_year&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;jerse_no&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="获取"><a href="#获取" class="headerlink" title="获取"></a>获取</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804235720075-750562025.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804235720075-750562025.png" alt="img"></a></p>
<h5 id="批量获取-1"><a href="#批量获取-1" class="headerlink" title="批量获取"></a>批量获取</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804235934557-1835658499.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200804235934557-1835658499.png" alt="img"></a></p>
<h5 id="获取所有mapping"><a href="#获取所有mapping" class="headerlink" title="获取所有mapping"></a>获取所有mapping</h5><h6 id="方式一-1"><a href="#方式一-1" class="headerlink" title="方式一"></a>方式一</h6><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805000120407-199889513.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805000120407-199889513.png" alt="img"></a></p>
<h6 id="方式二-1"><a href="#方式二-1" class="headerlink" title="方式二"></a>方式二</h6><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805000337375-1406369531.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805000337375-1406369531.png" alt="img"></a></p>
<h5 id="添加一个字段"><a href="#添加一个字段" class="headerlink" title="添加一个字段"></a>添加一个字段</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805001039629-1601658880.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805001039629-1601658880.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805001145345-181954942.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805001145345-181954942.png" alt="img"></a></p>
<h4 id="文档的操作"><a href="#文档的操作" class="headerlink" title="文档的操作"></a>文档的操作</h4><h5 id="新增-2"><a href="#新增-2" class="headerlink" title="新增"></a>新增</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805223923544-990373238.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805223923544-990373238.png" alt="img"></a></p>
<h5 id="不指定id方式新增"><a href="#不指定id方式新增" class="headerlink" title="不指定id方式新增"></a>不指定id方式新增</h5><p>踩坑(要POST请求)</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805224714729-439133697.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805224714729-439133697.png" alt="img"></a></p>
<h5 id="自动创建索引"><a href="#自动创建索引" class="headerlink" title="自动创建索引"></a>自动创建索引</h5><ul>
<li>查看auto_create_index开关状态，请求:<a href="http://ip:port/_cluster/settings">http://ip:port/_cluster/settings</a></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805230643572-1306702978.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805230643572-1306702978.png" alt="img"></a></p>
<ul>
<li>当索引不存在并且auto_create_index为true的时候，新增文档时会自动创建索引</li>
<li>修改auto_create_index状态<ul>
<li>put方式：ip:port&#x2F;_cluster&#x2F;settings</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805230932663-1448852150.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805230932663-1448852150.png" alt="img"></a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;persistent&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;action.auto_create_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>　　当auto_create_index&#x3D;false时，指定一个不存在的索引，新增文档</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805231416517-604708195.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805231416517-604708195.png" alt="img"></a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;杨超越&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;team_name&quot;</span><span class="punctuation">:</span><span class="string">&quot;梦之队&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span><span class="string">&quot;组织后卫&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;play_year&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;jerse_no&quot;</span><span class="punctuation">:</span><span class="string">&quot;18&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="指定操作类型"><a href="#指定操作类型" class="headerlink" title="指定操作类型"></a>指定操作类型</h5><p>PUT请求：ip:port&#x2F;xxx&#x2F;_doc&#x2F;1?op_type&#x3D;create</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805232518960-1487908581.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805232518960-1487908581.png" alt="img"></a></p>
<h5 id="文档查看"><a href="#文档查看" class="headerlink" title="文档查看"></a>文档查看</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805224238141-723526011.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805224238141-723526011.png" alt="img"></a></p>
<h5 id="查看多个文档"><a href="#查看多个文档" class="headerlink" title="查看多个文档"></a>查看多个文档</h5><h6 id="方式一-2"><a href="#方式一-2" class="headerlink" title="方式一"></a>方式一</h6><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805233311150-630285133.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805233311150-630285133.png" alt="img"></a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;docs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nba&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nba&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h6 id="方式二-2"><a href="#方式二-2" class="headerlink" title="方式二"></a>方式二</h6><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805233524171-984793616.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805233524171-984793616.png" alt="img"></a></p>
<h6 id="方式三"><a href="#方式三" class="headerlink" title="方式三"></a>方式三</h6><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805233803816-634801041.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805233803816-634801041.png" alt="img"></a></p>
<h6 id="方式四"><a href="#方式四" class="headerlink" title="方式四"></a>方式四</h6><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805234007055-1686498360.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805234007055-1686498360.png" alt="img"></a></p>
<h6 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h6><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805234709156-1124673982.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805234709156-1124673982.png" alt="img"></a></p>
<h5 id="向-source字段，增加一个字段"><a href="#向-source字段，增加一个字段" class="headerlink" title="向_source字段，增加一个字段"></a>向_source字段，增加一个字段</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805235534845-1151500934.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200805235534845-1151500934.png" alt="img"></a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;script&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ctx._source.age = 18&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="从source字段，删除一个字段"><a href="#从source字段，删除一个字段" class="headerlink" title="从source字段，删除一个字段"></a>从source字段，删除一个字段</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806000427390-1076577418.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806000427390-1076577418.png" alt="img"></a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;script&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ctx._source.remove(\&quot;age\&quot;)&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="根据参数值，更新指定文档的字段"><a href="#根据参数值，更新指定文档的字段" class="headerlink" title="根据参数值，更新指定文档的字段"></a>根据参数值，更新指定文档的字段</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806001240946-2096723700.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806001240946-2096723700.png" alt="img"></a></p>
<p>　　upsert当指定的文档不存在时，upsert参数包含的内容将会被插入到索引中，作为一个新文档；如果指定的文档存在，ElasticSearch引擎将会执行指定的更新逻辑。</p>
<h4 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h4><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806001608900-921648927.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806001608900-921648927.png" alt="img"></a></p>
<h4 id="搜索的简单使用"><a href="#搜索的简单使用" class="headerlink" title="搜索的简单使用"></a>搜索的简单使用</h4><h5 id="删除nba索引"><a href="#删除nba索引" class="headerlink" title="删除nba索引"></a>删除nba索引</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806220053432-1325323877.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806220053432-1325323877.png" alt="img"></a></p>
<h5 id="新建一个索引"><a href="#新建一个索引" class="headerlink" title="新建一个索引"></a>新建一个索引</h5><p>并指定mapping</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806220301472-1689820610.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806220301472-1689820610.png" alt="img"></a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;team_name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;play_year&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;jerse_no&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="新增document"><a href="#新增document" class="headerlink" title="新增document"></a>新增document</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806220455377-963381252.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806220455377-963381252.png" alt="img"></a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168</span><span class="number">.199</span><span class="number">.170</span><span class="punctuation">:</span><span class="number">9200</span>/nba/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;哈登&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;team_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;⽕箭&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;得分后卫&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;play_year&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;jerse_no&quot;</span><span class="punctuation">:</span> <span class="string">&quot;13&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168</span><span class="number">.199</span><span class="number">.170</span><span class="punctuation">:</span><span class="number">9200</span>/nba/_doc/<span class="number">2</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;库⾥&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;team_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;勇⼠&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;控球后卫&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;play_year&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;jerse_no&quot;</span><span class="punctuation">:</span> <span class="string">&quot;30&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168</span><span class="number">.199</span><span class="number">.170</span><span class="punctuation">:</span><span class="number">9200</span>/nba/_doc/<span class="number">3</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;詹姆斯&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;team_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;湖⼈&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;⼩前锋&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;play_year&quot;</span><span class="punctuation">:</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;jerse_no&quot;</span><span class="punctuation">:</span> <span class="string">&quot;23&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="词条查询-term"><a href="#词条查询-term" class="headerlink" title="词条查询(term)"></a>词条查询(term)</h4><p>　　词条查询不会分析查询条件，只有当词条和查询字符串完全匹配时，才匹配搜索。</p>
<h5 id="单条term查询"><a href="#单条term查询" class="headerlink" title="单条term查询"></a>单条term查询</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806225524638-1582739295.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806225524638-1582739295.png" alt="img"></a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;jerse_no&quot;</span><span class="punctuation">:</span> <span class="string">&quot;23&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="多条term查询"><a href="#多条term查询" class="headerlink" title="多条term查询"></a>多条term查询</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806230100919-1026027759.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806230100919-1026027759.png" alt="img"></a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;jerse_no&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;23&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;13&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="全文查询-full-text"><a href="#全文查询-full-text" class="headerlink" title="全文查询(full text)"></a>全文查询(full text)</h4><p>　　ElasticSearch引擎会先分析查询字符串，将其拆分成多个分词，只要已分析的字段中包含词条的任意一个，或全部包含，就匹配查询条件，返回该文档；如果不包含任意一个分词，表示没有任何问的那个匹配查询条件</p>
<h5 id="match-all"><a href="#match-all" class="headerlink" title="match_all"></a>match_all</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806230828824-1741012944.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806230828824-1741012944.png" alt="img"></a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="match"><a href="#match" class="headerlink" title="match"></a>match</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806231059033-1411401384.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806231059033-1411401384.png" alt="img"></a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span><span class="string">&quot;后卫&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="multi-match"><a href="#multi-match" class="headerlink" title="multi_match"></a>multi_match</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806231723234-1589703110.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806231723234-1589703110.png" alt="img"></a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;multi_match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shooter&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;title&quot;</span><span class="punctuation">,</span> <span class="string">&quot;name&quot;</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">post <span class="number">192.168</span><span class="number">.199</span><span class="number">.170</span><span class="punctuation">:</span><span class="number">9200</span>/nba/_update/<span class="number">2</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;库⾥&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;team_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;勇⼠&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;控球后卫&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;play_year&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;jerse_no&quot;</span><span class="punctuation">:</span> <span class="string">&quot;30&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;the best shooter&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="match-phrase"><a href="#match-phrase" class="headerlink" title="match_phrase"></a>match_phrase</h5><p>　　类似于词条查询，精准查询</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806232024365-608717834.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806232024365-608717834.png" alt="img"></a></p>
<h5 id="match-phrase-prefix"><a href="#match-phrase-prefix" class="headerlink" title="match_phrase_prefix"></a>match_phrase_prefix</h5><p>　　前缀匹配</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806232528531-599792971.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806232528531-599792971.png" alt="img"></a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match_phrase_prefix&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;the best s&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">post 192.168.199.170:9200/nba/_update/3</span><br><span class="line">&#123;</span><br><span class="line">    &quot;doc&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;詹姆斯&quot;,</span><br><span class="line">        &quot;team_name&quot;: &quot;湖⼈&quot;,</span><br><span class="line">        &quot;position&quot;: &quot;⼩前锋&quot;,</span><br><span class="line">        &quot;play_year&quot;: 15,</span><br><span class="line">        &quot;jerse_no&quot;: &quot;23&quot;,</span><br><span class="line">        &quot;title&quot;: &quot;the best small forward&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="分词器的介绍和使用"><a href="#分词器的介绍和使用" class="headerlink" title="分词器的介绍和使用#"></a>分词器的介绍和使用<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E5%88%86%E8%AF%8D%E5%99%A8%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8">#</a></h1><h2 id="什么是分词器"><a href="#什么是分词器" class="headerlink" title="什么是分词器#"></a>什么是分词器<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E4%BB%80%E4%B9%88%E6%98%AF%E5%88%86%E8%AF%8D%E5%99%A8">#</a></h2><ul>
<li>将用户输入的一段文本，按照一定逻辑，分析成多个词语的一种工具</li>
<li>example：The best 3-points shooter is Curry!</li>
</ul>
<h2 id="常用的内置分词器"><a href="#常用的内置分词器" class="headerlink" title="常用的内置分词器#"></a>常用的内置分词器<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E5%B8%B8%E7%94%A8%E7%9A%84%E5%86%85%E7%BD%AE%E5%88%86%E8%AF%8D%E5%99%A8">#</a></h2><ol>
<li>standard analyzer</li>
<li>simple analyzer</li>
<li>whitespace analyzer</li>
<li>stop analyzer</li>
<li>language analyzer</li>
<li>pattern analyzer</li>
</ol>
<h3 id="standard-analyzer"><a href="#standard-analyzer" class="headerlink" title="standard analyzer#"></a>standard analyzer<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#standard-analyzer">#</a></h3><p>　　标准分析器是<strong>默认分词器</strong>，如果未指定，则使用该分词器</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806233815373-430057577.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806233815373-430057577.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;analyzer&quot;: &quot;standard&quot;,</span><br><span class="line">    &quot;text&quot;: &quot;The best 3-points shooter is Curry!&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="simple-analyzer"><a href="#simple-analyzer" class="headerlink" title="simple analyzer#"></a>simple analyzer<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#simple-analyzer">#</a></h3><p>　　simple分析器当他遇到只要<strong>不是字母的字符</strong>，就将文本解析成term，而且<strong>所有的term都是小写</strong>的</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806234024004-16094870.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806234024004-16094870.png" alt="img"></a></p>
<h3 id="whitespace-analyzer"><a href="#whitespace-analyzer" class="headerlink" title="whitespace analyzer#"></a>whitespace analyzer<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#whitespace-analyzer">#</a></h3><p>　　whitespace分析器，当他遇到<strong>空白字符</strong>时，就将文本解析成terms</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806234223428-873735848.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806234223428-873735848.png" alt="img"></a></p>
<h3 id="stop-analyzer"><a href="#stop-analyzer" class="headerlink" title="stop analyzer#"></a>stop analyzer<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#stop-analyzer">#</a></h3><p>　　stop分析器和simple分析器很想，唯一不同的是，stop分析器增加了对删除停止词的支持，默认使用了english停止词</p>
<p>　　stopwords预定义的停止词列表，比如(ths,a,an,this,of,at)等等</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806235244774-512010109.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806235244774-512010109.png" alt="img"></a></p>
<h3 id="language-analyzer"><a href="#language-analyzer" class="headerlink" title="language analyzer#"></a>language analyzer<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#language-analyzer">#</a></h3><p>（特定的语⾔的分词器，⽐如说，english，英语分词器),内置语⾔：arabic, armenian,</p>
<p>basque, bengali, brazilian, bulgarian, catalan, cjk, czech, danish, dutch, english, fifinnish,</p>
<p>french, galician, german, greek, hindi, hungarian, indonesian, irish, italian, latvian,</p>
<p>lithuanian, norwegian, persian, portuguese, romanian, russian, sorani, spanish,</p>
<p>swedish, turkish, thai </p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806235513483-623924294.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806235513483-623924294.png" alt="img"></a></p>
<h3 id="pattern-analyzer"><a href="#pattern-analyzer" class="headerlink" title="pattern analyzer#"></a>pattern analyzer<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#pattern-analyzer">#</a></h3><p>　　用正则表达式将文本分割成sterms，默认的正则表达式是\W+</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806235651515-158758844.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200806235651515-158758844.png" alt="img"></a></p>
<h3 id="选择分词器"><a href="#选择分词器" class="headerlink" title="选择分词器#"></a>选择分词器<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E9%80%89%E6%8B%A9%E5%88%86%E8%AF%8D%E5%99%A8">#</a></h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200807000753119-447127850.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200807000753119-447127850.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">put 192.168.199.170:9200/my_index</span><br><span class="line">&#123;</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">        &quot;analysis&quot;: &#123;</span><br><span class="line">            &quot;analyzer&quot;: &#123;</span><br><span class="line">                &quot;my_analyzer&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;: &quot;whitespace&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;mappings&quot;: &#123;</span><br><span class="line">        &quot;properties&quot;: &#123;</span><br><span class="line">            &quot;name&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;text&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;team_name&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;text&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;position&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;text&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;play_year&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;long&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;jerse_no&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;title&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">                &quot;analyzer&quot;: &quot;my_analyzer&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200807000901015-1272170885.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200807000901015-1272170885.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;库⾥&quot;,</span><br><span class="line">    &quot;team_name&quot;: &quot;勇⼠&quot;,</span><br><span class="line">    &quot;position&quot;: &quot;控球后卫&quot;,</span><br><span class="line">    &quot;play_year&quot;: 10,</span><br><span class="line">    &quot;jerse_no&quot;: &quot;30&quot;,</span><br><span class="line">    &quot;title&quot;: &quot;The best 3-points shooter is Curry!&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200807001028699-954689699.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200807001028699-954689699.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match&quot;: &#123;</span><br><span class="line">            &quot;title&quot;: &quot;Curry!&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="常见中文分词器"><a href="#常见中文分词器" class="headerlink" title="常见中文分词器"></a>常见中文分词器</h4><h5 id="默认的分词standard"><a href="#默认的分词standard" class="headerlink" title="默认的分词standard"></a>默认的分词standard</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200807220444617-1385681451.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200807220444617-1385681451.png" alt="img"></a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;standard&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;⽕箭明年总冠军&quot;</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="常见分词器"><a href="#常见分词器" class="headerlink" title="常见分词器"></a>常见分词器</h5><ul>
<li>smartCN一个简单的中文或中英文混合文本的分词器</li>
<li>IK分词器，更智能更友好的中文分词器</li>
</ul>
<h4 id="常见的字段类型"><a href="#常见的字段类型" class="headerlink" title="常见的字段类型"></a>常见的字段类型</h4><h5 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h5><ul>
<li>核心数据类型</li>
<li>复杂数据类型</li>
<li>专用数据类型</li>
</ul>
<h5 id="核心数据类型"><a href="#核心数据类型" class="headerlink" title="核心数据类型"></a>核心数据类型</h5><h6 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h6><ul>
<li>text：用于全文索引，该类型的字段将通过分词器进行分词</li>
<li>keyword：不分词，只能搜索该字段的完整的值</li>
</ul>
<h6 id="数值型"><a href="#数值型" class="headerlink" title="数值型"></a>数值型</h6><ul>
<li>long、integer、short、byte、double、float、half_float、scaled_float</li>
</ul>
<h6 id="布尔"><a href="#布尔" class="headerlink" title="布尔"></a>布尔</h6><ul>
<li>boolean</li>
</ul>
<h6 id="二进制"><a href="#二进制" class="headerlink" title="二进制"></a>二进制</h6><ul>
<li>binary：该类型的字段把值当做经过base64编码的字符串，默认不存储，且不可搜索</li>
</ul>
<h6 id="范围类型"><a href="#范围类型" class="headerlink" title="范围类型"></a>范围类型</h6><ol>
<li>范围类型表示值是一个范围，而不是一个具体的值</li>
<li>integer_range、float_range、long_range、double_range、date_range</li>
<li>比如age类型是integer_range，那么值可以是{“gte”:20,”lte”:40}；搜索”term”:{“age”:21}可以搜索该值</li>
</ol>
<h6 id="日期-date"><a href="#日期-date" class="headerlink" title="日期-date"></a>日期-date</h6><p>　　由于json类型没有date类型，所以es通过识别字符串是否符合format定义的格式来判断是否为date类型</p>
<p>　　format默认为：strict_date_optional_time || epoch_millis</p>
<p>　　格式</p>
<p>　　　　“2022-01-01” “2022&#x2F;01&#x2F;01 12:10:30” 这种字符串格式</p>
<p>　　从开始纪元（1970年1月1日0点）开始的毫秒数</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT <span class="number">192.168</span><span class="number">.199</span><span class="number">.170</span><span class="punctuation">:</span><span class="number">9200</span>/nba/_mapping</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;team_name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;play_year&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;jerse_no&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;date&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST <span class="number">192.168</span><span class="number">.199</span><span class="number">.170</span><span class="punctuation">:</span><span class="number">9200</span>/nba/_doc/<span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;蔡x坤&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;team_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;勇⼠&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;得分后卫&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;play_year&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;jerse_no&quot;</span><span class="punctuation">:</span> <span class="string">&quot;31&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;打球最帅的明星&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2020-01-01&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST <span class="number">192.168</span><span class="number">.199</span><span class="number">.170</span><span class="punctuation">:</span><span class="number">9200</span>/nba/_doc/<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;杨超越&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;team_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;猴急&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;得分后卫&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;play_year&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;jerse_no&quot;</span><span class="punctuation">:</span> <span class="string">&quot;32&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;打球最可爱的明星&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="number">1610350870</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="复杂数据类型"><a href="#复杂数据类型" class="headerlink" title="复杂数据类型"></a>复杂数据类型</h5><h6 id="数据类型-Array"><a href="#数据类型-Array" class="headerlink" title="数据类型 Array"></a>数据类型 Array</h6><ul>
<li>ES中没有专门的数据类型，直接使用[]定义接口，数组中所有的值必须是同一种数据类型，不支持混合数据类型的数组</li>
<li>字符串数组[“one”,”two”]</li>
<li>整数数组[1,2]</li>
<li>Object对象数组[{“name”:”alex”,”age”:18},{“name”:”tom”,”age”:18}]</li>
</ul>
<h6 id="对象类型Object"><a href="#对象类型Object" class="headerlink" title="对象类型Object"></a>对象类型Object</h6><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST 192.168.199.170:9200/nba/_doc/8</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;吴亦凡&quot;,</span><br><span class="line">    &quot;team_name&quot;: &quot;湖⼈&quot;,</span><br><span class="line">    &quot;position&quot;: &quot;得分后卫&quot;,</span><br><span class="line">    &quot;play_year&quot;: 10,</span><br><span class="line">    &quot;jerse_no&quot;: &quot;33&quot;,</span><br><span class="line">    &quot;title&quot;: &quot;最会说唱的明星&quot;,</span><br><span class="line">    &quot;date&quot;: &quot;1641886870&quot;,</span><br><span class="line">    &quot;array&quot;: [</span><br><span class="line">        &quot;one&quot;,</span><br><span class="line">        &quot;two&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;address&quot;: &#123;</span><br><span class="line">        &quot;region&quot;: &quot;China&quot;,</span><br><span class="line">        &quot;location&quot;: &#123;</span><br><span class="line">            &quot;province&quot;: &quot;GuangDong&quot;,</span><br><span class="line">            &quot;city&quot;: &quot;GuangZhou&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>索引方式</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;address.region&quot;</span><span class="punctuation">:</span> <span class="string">&quot;China&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;address.location.province&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GuangDong&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;address.location.city&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GuangZhou&quot;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST 192.168.199.170:9200/nba/_search</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match&quot;: &#123;</span><br><span class="line">            &quot;address.region&quot;: &quot;china&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="专用数据类型"><a href="#专用数据类型" class="headerlink" title="专用数据类型"></a>专用数据类型</h5><h6 id="IP类型"><a href="#IP类型" class="headerlink" title="IP类型"></a>IP类型</h6><p>　　IP类型的字段用于存储IPv4和IPv6的地址，本质上是一个长整形字段</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST 192.168.199.170:9200/nba/_mapping</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;text&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;team_name&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;text&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;position&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;text&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;play_year&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;long&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;jerse_no&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;title&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;text&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;date&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;date&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ip_addr&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;ip&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">PUT 192.168.199.170:9200/nba/_doc/9</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;吴亦凡&quot;,</span><br><span class="line">    &quot;team_name&quot;: &quot;湖⼈&quot;,</span><br><span class="line">    &quot;position&quot;: &quot;得分后卫&quot;,</span><br><span class="line">    &quot;play_year&quot;: 10,</span><br><span class="line">    &quot;jerse_no&quot;: &quot;33&quot;,</span><br><span class="line">    &quot;title&quot;: &quot;最会说唱的明星&quot;,</span><br><span class="line">    &quot;ip_addr&quot;: &quot;192.168.1.1&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST 192.168.199.170:9200/nba/_search</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;term&quot;: &#123;</span><br><span class="line">            &quot;ip_addr&quot;: &quot;192.168.0.0/16&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ES之批量导入数据"><a href="#ES之批量导入数据" class="headerlink" title="ES之批量导入数据"></a>ES之批量导入数据</h4><h5 id="Bulk"><a href="#Bulk" class="headerlink" title="Bulk"></a>Bulk</h5><p>　　ES提供了一个叫bulk的API来进行批量操作</p>
<h5 id="批量导入"><a href="#批量导入" class="headerlink" title="批量导入"></a>批量导入</h5><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;book&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;权⼒的游戏&quot;</span><span class="punctuation">&#125;</span> <span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;book&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;疯狂的⽯头&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808225914165-1026861927.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808225914165-1026861927.png" alt="img"></a></p>
<h5 id="POST-bulk"><a href="#POST-bulk" class="headerlink" title="POST bulk"></a>POST bulk</h5><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">curl -X POST &quot;192.168.199.170:9200/_bulk&quot; -H &#x27;Content-Type: application/json&#x27; --data-binary @test</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808231101430-503962155.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808231101430-503962155.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808231433833-1757607767.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808231433833-1757607767.png" alt="img"></a></p>
<h4 id="ES之term的多种查询"><a href="#ES之term的多种查询" class="headerlink" title="ES之term的多种查询"></a>ES之term的多种查询</h4><h5 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h5><ul>
<li>单词级别查询</li>
<li>这些查询通常用于结构化的数据，比如：number，data，keyword等，而不是对text</li>
<li>也就是说，全文查询之前要先对文本内容进行分词，而单词级别的查询直接在相应字段的反向索引中精确查找，单词级别的查询一般用于数值、日期等类型的字段上</li>
</ul>
<h5 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h5><ol>
<li>删除nba</li>
<li>新增nba索引</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&quot;mappings&quot;:&#123;&quot;properties&quot;:&#123;&quot;birthDay&quot;:&#123;&quot;type&quot;:&quot;date&quot;&#125;,&quot;birthDayStr&quot;: &#123;&quot;type&quot;:&quot;keyword&quot;&#125;,&quot;age&quot;:&#123;&quot;type&quot;:&quot;integer&quot;&#125;,&quot;code&quot;: &#123;&quot;type&quot;:&quot;text&quot;&#125;,&quot;country&quot;:&#123;&quot;type&quot;:&quot;text&quot;&#125;,&quot;countryEn&quot;: &#123;&quot;type&quot;:&quot;text&quot;&#125;,&quot;displayAffiliation&quot;:&#123;&quot;type&quot;:&quot;text&quot;&#125;,&quot;displayName&quot;: &#123;&quot;type&quot;:&quot;text&quot;&#125;,&quot;displayNameEn&quot;:&#123;&quot;type&quot;:&quot;text&quot;&#125;,&quot;draft&quot;: &#123;&quot;type&quot;:&quot;long&quot;&#125;,&quot;heightValue&quot;:&#123;&quot;type&quot;:&quot;float&quot;&#125;,&quot;jerseyNo&quot;: &#123;&quot;type&quot;:&quot;text&quot;&#125;,&quot;playYear&quot;:&#123;&quot;type&quot;:&quot;long&quot;&#125;,&quot;playerId&quot;: &#123;&quot;type&quot;:&quot;keyword&quot;&#125;,&quot;position&quot;:&#123;&quot;type&quot;:&quot;text&quot;&#125;,&quot;schoolType&quot;: &#123;&quot;type&quot;:&quot;text&quot;&#125;,&quot;teamCity&quot;:&#123;&quot;type&quot;:&quot;text&quot;&#125;,&quot;teamCityEn&quot;: &#123;&quot;type&quot;:&quot;text&quot;&#125;,&quot;teamConference&quot;: &#123;&quot;type&quot;:&quot;keyword&quot;&#125;,&quot;teamConferenceEn&quot;:&#123;&quot;type&quot;:&quot;keyword&quot;&#125;,&quot;teamName&quot;: &#123;&quot;type&quot;:&quot;keyword&quot;&#125;,&quot;teamNameEn&quot;:&#123;&quot;type&quot;:&quot;keyword&quot;&#125;,&quot;weight&quot;: &#123;&quot;type&quot;:&quot;text&quot;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808233602292-1308096637.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808233602292-1308096637.png" alt="img"></a></p>
<ul>
<li>批量导入player</li>
</ul>
<h5 id="Term-query精准匹配查询"><a href="#Term-query精准匹配查询" class="headerlink" title="Term query精准匹配查询"></a>Term query精准匹配查询</h5><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;jerseyNo&quot;: &quot;23&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 20</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808234209450-1782525297.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808234209450-1782525297.png" alt="img"></a></p>
<p>Exsit Query在特定的字段中查找非空值的文档(查找队名非空的球员)</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808234336576-1970469819.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808234336576-1970469819.png" alt="img"></a></p>
<p>Prefix Query查找包含带有指定前缀term的文档(查找队名为Rock开头的球员)</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808234526577-1615967790.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808234526577-1615967790.png" alt="img"></a></p>
<p>Wildcard Query支持通配符查询，*表示任意字符，?表示任意单个字符（查找火箭队的球员）</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808234708022-227227798.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808234708022-227227798.png" alt="img"></a></p>
<p>Regexp Query正则表达式查询（查找火箭队的球员）</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808234838930-2067334620.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808234838930-2067334620.png" alt="img"></a></p>
<p>Ids Query(查找id为1和2的球员)</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808234955192-409886664.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200808234955192-409886664.png" alt="img"></a></p>
<h5 id="ES的范围查询"><a href="#ES的范围查询" class="headerlink" title="ES的范围查询"></a>ES的范围查询</h5><p>查询指定字段在指定范围内包含值（日期、数字或字符串）的文档</p>
<p>　　查找在nba打球在2年到10年以内的球员</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809135838450-748621644.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809135838450-748621644.png" alt="img"></a></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;range&quot;: &#123;</span><br><span class="line">      &quot;playYear&quot;: &#123;</span><br><span class="line">        &quot;gte&quot;: 2,</span><br><span class="line">        &quot;lte&quot;: 10</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 20</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查找1999年到2020年出生的球员</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809141718939-709337714.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809141718939-709337714.png" alt="img"></a></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;range&quot;: &#123;</span><br><span class="line">      &quot;birthDay&quot;: &#123;</span><br><span class="line">        &quot;gte&quot;: &quot;01/01/1999&quot;,</span><br><span class="line">        &quot;lte&quot;: &quot;2020&quot;,</span><br><span class="line">        &quot;format&quot;: &quot;dd/MM/yyyy||yyyy&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 20</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="ES的布尔查询"><a href="#ES的布尔查询" class="headerlink" title="ES的布尔查询"></a>ES的布尔查询</h5><h6 id="布尔查询"><a href="#布尔查询" class="headerlink" title="布尔查询"></a>布尔查询</h6><table>
<thead>
<tr>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>must</td>
<td>必须出现在匹配文档中</td>
</tr>
<tr>
<td>filter</td>
<td>必须出现在文档中，但是不打分</td>
</tr>
<tr>
<td>must_not</td>
<td>不能出现在文档中</td>
</tr>
<tr>
<td>should</td>
<td>应该出现在文档中</td>
</tr>
</tbody></table>
<h5 id="must-查询名字叫做james的球员"><a href="#must-查询名字叫做james的球员" class="headerlink" title="must(查询名字叫做james的球员)"></a>must(查询名字叫做james的球员)</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809142614367-749768234.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809142614367-749768234.png" alt="img"></a></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;displayNameEn&quot;: &quot;james&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 20</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="效果同must，但是不打分-查找名字叫做james的球员"><a href="#效果同must，但是不打分-查找名字叫做james的球员" class="headerlink" title="效果同must，但是不打分(查找名字叫做james的球员)"></a>效果同must，但是不打分(查找名字叫做james的球员)</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809143117376-167327594.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809143117376-167327594.png" alt="img"></a></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;displayNameEn&quot;: &quot;james&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 20</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="must-not（查找名字叫做James的西部球员）"><a href="#must-not（查找名字叫做James的西部球员）" class="headerlink" title="must_not（查找名字叫做James的西部球员）"></a>must_not（查找名字叫做James的西部球员）</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809143520540-1491349438.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809143520540-1491349438.png" alt="img"></a></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;displayNameEn&quot;: &quot;james&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;must_not&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;term&quot;: &#123;</span><br><span class="line">            &quot;teamConferenceEn&quot;: &#123;</span><br><span class="line">              &quot;value&quot;: &quot;Eastern&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 20</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>组合起来含义：一定不在东部的james</p>
<h5 id="should（查找名字叫做James的打球时间应该在11到20年西部球员）"><a href="#should（查找名字叫做James的打球时间应该在11到20年西部球员）" class="headerlink" title="should（查找名字叫做James的打球时间应该在11到20年西部球员）"></a>should（查找名字叫做James的打球时间应该在11到20年西部球员）</h5><p>即使匹配不到也返回，只是评分不同</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809144031938-1716897268.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809144031938-1716897268.png" alt="img"></a></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;displayNameEn&quot;: &quot;james&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;must_not&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;term&quot;: &#123;</span><br><span class="line">            &quot;teamConferenceEn&quot;: &#123;</span><br><span class="line">              &quot;value&quot;: &quot;Eastern&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;should&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;range&quot;: &#123;</span><br><span class="line">            &quot;playYear&quot;: &#123;</span><br><span class="line">              &quot;gte&quot;: 11,</span><br><span class="line">              &quot;lte&quot;: 20</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 20</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果minimum_should_match&#x3D;1，则变成要查出名字叫做James的打球时间在11年到20年西部球员</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809144315828-224639319.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809144315828-224639319.png" alt="img"></a></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;displayNameEn&quot;: &quot;james&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;must_not&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;term&quot;: &#123;</span><br><span class="line">            &quot;teamConferenceEn&quot;: &#123;</span><br><span class="line">              &quot;value&quot;: &quot;Eastern&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;should&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;range&quot;: &#123;</span><br><span class="line">            &quot;playYear&quot;: &#123;</span><br><span class="line">              &quot;gte&quot;: 11,</span><br><span class="line">              &quot;lte&quot;: 20</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;minimum_should_match&quot;: 1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 20</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>minimum_should_match代表了最小匹配经度，如果设置minimum_should_match&#x3D;1，那么should语句中至少需要有一个条件满足</p>
<h4 id="ES的排序"><a href="#ES的排序" class="headerlink" title="ES的排序"></a>ES的排序</h4><h5 id="火箭队中按打球时间从大到小排序的球员"><a href="#火箭队中按打球时间从大到小排序的球员" class="headerlink" title="火箭队中按打球时间从大到小排序的球员"></a>火箭队中按打球时间从大到小排序的球员</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809145015029-2043407873.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809145015029-2043407873.png" alt="img"></a></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;teamNameEn&quot;: &quot;Rockets&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;playYear&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;desc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ], </span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 20</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>火箭队中按打球时间从大到小，如果年龄相同则按照身高从高到低排序的球员</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809145230889-307097425.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809145230889-307097425.png" alt="img"></a></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;teamNameEn&quot;: &quot;Rockets&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;playYear&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;desc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,&#123;</span><br><span class="line">      &quot;heightValue&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;asc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 20</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="ES聚合查询之指标聚合"><a href="#ES聚合查询之指标聚合" class="headerlink" title="ES聚合查询之指标聚合"></a>ES聚合查询之指标聚合</h4><h5 id="ES聚合查询是什么"><a href="#ES聚合查询是什么" class="headerlink" title="ES聚合查询是什么"></a>ES聚合查询是什么</h5><ol>
<li><strong>聚合查询是数据库</strong>中<strong>重要</strong>的<strong>功能特性</strong>，完成对一个查询得到的数据集的聚合计算，如：找出某字段(或计算表达式的结果)的<strong>最大值，最小值，计算和，平均值</strong>等。ES作为搜索引擎，同样提供了强大的聚合分析能力</li>
<li>对一个数据集求最大、最小、和、平均值等指标的聚合，在ES中称为<strong>指标聚合</strong></li>
<li>而关系型数据库中除了有聚合函数外，还可以对查询出的数据进行分组group by，再在组上进行指标聚合。在ES中称为“<strong>桶聚合</strong>”</li>
</ol>
<h5 id="max-min-sum-avg"><a href="#max-min-sum-avg" class="headerlink" title="max min sum avg"></a>max min sum avg</h5><h6 id="求出火箭队球员的平均年龄"><a href="#求出火箭队球员的平均年龄" class="headerlink" title="求出火箭队球员的平均年龄"></a>求出火箭队球员的平均年龄</h6><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809194808911-809076093.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809194808911-809076093.png" alt="img"></a></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST /nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;teamNameEn&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;Rockets&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;avgAge&quot;: &#123;</span><br><span class="line">      &quot;avg&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="value-count统计非空字段的文档数"><a href="#value-count统计非空字段的文档数" class="headerlink" title="value_count统计非空字段的文档数"></a>value_count统计非空字段的文档数</h5><h6 id="求出火箭队中球员打球时间不为空的数量"><a href="#求出火箭队中球员打球时间不为空的数量" class="headerlink" title="求出火箭队中球员打球时间不为空的数量"></a>求出火箭队中球员打球时间不为空的数量</h6><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809195050863-627295009.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809195050863-627295009.png" alt="img"></a></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST /nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;teamNameEn&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;Rockets&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;countPlayerYear&quot;: &#123;</span><br><span class="line">      &quot;value_count&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;playYear&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="查出火箭队有多少名球员"><a href="#查出火箭队有多少名球员" class="headerlink" title="查出火箭队有多少名球员"></a>查出火箭队有多少名球员</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809195209347-591320535.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809195209347-591320535.png" alt="img"></a></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST /nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;teamNameEn&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;Rockets&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Cardinality值去重计数"><a href="#Cardinality值去重计数" class="headerlink" title="Cardinality值去重计数"></a>Cardinality值去重计数</h5><h6 id="查出火箭队中年龄不同的数量"><a href="#查出火箭队中年龄不同的数量" class="headerlink" title="查出火箭队中年龄不同的数量"></a>查出火箭队中年龄不同的数量</h6><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809195431617-1014314746.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809195431617-1014314746.png" alt="img"></a></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST /nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;teamNameEn&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;Rockets&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;countAget&quot;: &#123;</span><br><span class="line">      &quot;cardinality&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="stats统计count-max-min-avg-sum5个值"><a href="#stats统计count-max-min-avg-sum5个值" class="headerlink" title="stats统计count max min avg sum5个值"></a>stats统计count max min avg sum5个值</h2><h4 id="查出火箭队球员的年龄stats"><a href="#查出火箭队球员的年龄stats" class="headerlink" title="查出火箭队球员的年龄stats"></a>查出火箭队球员的年龄stats</h4><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809195617781-1039383836.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809195617781-1039383836.png" alt="img"></a></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST /nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;teamNameEn&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;Rockets&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;statsAge&quot;: &#123;</span><br><span class="line">      &quot;stats&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ES聚合查询之桶聚合"><a href="#ES聚合查询之桶聚合" class="headerlink" title="ES聚合查询之桶聚合"></a>ES聚合查询之桶聚合</h4><h5 id="ES聚合分析是什么"><a href="#ES聚合分析是什么" class="headerlink" title="ES聚合分析是什么"></a>ES聚合分析是什么</h5><ul>
<li>聚合分析是数据库中重要的功能特性，完成对一个查询的数据集中数据的聚合计算，如：找出字段（或计算表达式的结果）的最大值、最小值、计算和、平均值等。ES作为搜索引擎兼容数据库，同样提供了强大的聚合分析能力</li>
<li>对一个<strong>数据集求最大、最小、和、平均值</strong>等指标的聚合，在ES中称为<strong>指标聚合</strong></li>
<li>而关系型数据库中除了有聚合函数外，还可以对查询出的数据进行分组group by，再在组上进行游标聚合。在ES中称为<em>桶聚合</em></li>
</ul>
<h5 id="Terms-Aggregation根据字段项分组聚合"><a href="#Terms-Aggregation根据字段项分组聚合" class="headerlink" title="Terms Aggregation根据字段项分组聚合"></a>Terms Aggregation根据字段项分组聚合</h5><h6 id="火箭队根据年龄进行分组"><a href="#火箭队根据年龄进行分组" class="headerlink" title="火箭队根据年龄进行分组"></a>火箭队根据年龄进行分组</h6><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809210439225-2024418892.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809210439225-2024418892.png" alt="img"></a></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST /nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;teamNameEn&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;Rockets&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;aggsAge&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;,</span><br><span class="line">        &quot;size&quot;: 10</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="Order分组聚合排序"><a href="#Order分组聚合排序" class="headerlink" title="Order分组聚合排序"></a>Order分组聚合排序</h5><h6 id="火箭队根据年龄进行分组，分组信息通过年龄从大到小排序（通过指定字段）"><a href="#火箭队根据年龄进行分组，分组信息通过年龄从大到小排序（通过指定字段）" class="headerlink" title="火箭队根据年龄进行分组，分组信息通过年龄从大到小排序（通过指定字段）"></a>火箭队根据年龄进行分组，分组信息通过年龄从大到小排序（通过指定字段）</h6><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809210619184-724027637.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809210619184-724027637.png" alt="img"></a></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST /nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;teamNameEn&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;Rockets&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;aggsAge&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;,</span><br><span class="line">        &quot;size&quot;: 10,</span><br><span class="line">        &quot;order&quot;: &#123;</span><br><span class="line">          &quot;_key&quot;: &quot;desc&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="火箭队根据年龄进行分组，分组信息通过文档数从大到小排序（通过文档数）"><a href="#火箭队根据年龄进行分组，分组信息通过文档数从大到小排序（通过文档数）" class="headerlink" title="火箭队根据年龄进行分组，分组信息通过文档数从大到小排序（通过文档数）"></a>火箭队根据年龄进行分组，分组信息通过文档数从大到小排序（通过文档数）</h6><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809210748516-1811897803.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809210748516-1811897803.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;teamNameEn&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;Rockets&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;aggsAge&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;,</span><br><span class="line">        &quot;size&quot;: 10,</span><br><span class="line">        &quot;order&quot;: &#123;</span><br><span class="line">          &quot;_count&quot;: &quot;desc&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="每支球队按该队所有球员的平均年龄进行分组排序（通过分组指标值）"><a href="#每支球队按该队所有球员的平均年龄进行分组排序（通过分组指标值）" class="headerlink" title="每支球队按该队所有球员的平均年龄进行分组排序（通过分组指标值）"></a>每支球队按该队所有球员的平均年龄进行分组排序（通过分组指标值）</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809210923684-1903185006.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809210923684-1903185006.png" alt="img"></a></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST /nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;teamNameEn&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;Rockets&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;avgAge&quot;: &#123;</span><br><span class="line">      &quot;avg&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="筛选分组聚合"><a href="#筛选分组聚合" class="headerlink" title="筛选分组聚合#"></a>筛选分组聚合<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E7%AD%9B%E9%80%89%E5%88%86%E7%BB%84%E8%81%9A%E5%90%88">#</a></h2><h3 id="湖人和火箭队按球队平均年龄进行分组排序（指定值列表）"><a href="#湖人和火箭队按球队平均年龄进行分组排序（指定值列表）" class="headerlink" title="湖人和火箭队按球队平均年龄进行分组排序（指定值列表）#"></a>湖人和火箭队按球队平均年龄进行分组排序（指定值列表）<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E6%B9%96%E4%BA%BA%E5%92%8C%E7%81%AB%E7%AE%AD%E9%98%9F%E6%8C%89%E7%90%83%E9%98%9F%E5%B9%B3%E5%9D%87%E5%B9%B4%E9%BE%84%E8%BF%9B%E8%A1%8C%E5%88%86%E7%BB%84%E6%8E%92%E5%BA%8F%EF%BC%88%E6%8C%87%E5%AE%9A%E5%80%BC%E5%88%97%E8%A1%A8%EF%BC%89">#</a></h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809211354903-2026559599.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809211354903-2026559599.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;aggsTeamName&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;teamNameEn&quot;,</span><br><span class="line">        &quot;include&quot;: [</span><br><span class="line">          &quot;Lakers&quot;,</span><br><span class="line">          &quot;Rockets&quot;,</span><br><span class="line">          &quot;Warriors&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;exclude&quot;: [</span><br><span class="line">          &quot;Warriors&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;size&quot;: 30,</span><br><span class="line">        &quot;order&quot;: &#123;</span><br><span class="line">          &quot;avgAge&quot;: &quot;desc&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123;</span><br><span class="line">        &quot;avgAge&quot;: &#123;</span><br><span class="line">          &quot;avg&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;age&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="湖人和火箭队按球队平均年龄进行分组排序（正则表达式匹配值）"><a href="#湖人和火箭队按球队平均年龄进行分组排序（正则表达式匹配值）" class="headerlink" title="湖人和火箭队按球队平均年龄进行分组排序（正则表达式匹配值）#"></a>湖人和火箭队按球队平均年龄进行分组排序（正则表达式匹配值）<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E6%B9%96%E4%BA%BA%E5%92%8C%E7%81%AB%E7%AE%AD%E9%98%9F%E6%8C%89%E7%90%83%E9%98%9F%E5%B9%B3%E5%9D%87%E5%B9%B4%E9%BE%84%E8%BF%9B%E8%A1%8C%E5%88%86%E7%BB%84%E6%8E%92%E5%BA%8F%EF%BC%88%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8C%B9%E9%85%8D%E5%80%BC%EF%BC%89">#</a></h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809211553702-2083045496.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809211553702-2083045496.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;aggsTeamName&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;teamNameEn&quot;,</span><br><span class="line">        &quot;include&quot;: &quot;Lakers|Ro.*|Warriors.*&quot;,</span><br><span class="line">        &quot;exclude&quot;: &quot;Warriors&quot;,</span><br><span class="line">        &quot;size&quot;: 30,</span><br><span class="line">        &quot;order&quot;: &#123;</span><br><span class="line">          &quot;avgAge&quot;: &quot;desc&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123;</span><br><span class="line">        &quot;avgAge&quot;: &#123;</span><br><span class="line">          &quot;avg&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;age&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Range-Aggregation范围分组聚合"><a href="#Range-Aggregation范围分组聚合" class="headerlink" title="Range Aggregation范围分组聚合#"></a>Range Aggregation范围分组聚合<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#range-aggregation%E8%8C%83%E5%9B%B4%E5%88%86%E7%BB%84%E8%81%9A%E5%90%88">#</a></h2><h3 id="NBA球员年龄按20，20-35，35这样分组"><a href="#NBA球员年龄按20，20-35，35这样分组" class="headerlink" title="NBA球员年龄按20，20-35，35这样分组#"></a>NBA球员年龄按20，20-35，35这样分组<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#nba%E7%90%83%E5%91%98%E5%B9%B4%E9%BE%84%E6%8C%8920%EF%BC%8C20-35%EF%BC%8C35%E8%BF%99%E6%A0%B7%E5%88%86%E7%BB%84">#</a></h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809211848224-1134660634.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809211848224-1134660634.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;ageRange&quot;: &#123;</span><br><span class="line">      &quot;range&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;,</span><br><span class="line">        &quot;ranges&quot;: [</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;to&quot;: 20</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;from&quot;: 20,</span><br><span class="line">            &quot;to&quot;: 35</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;to&quot;: 35</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="NBA球员年龄按20，20-35，35这样分组（起别名）"><a href="#NBA球员年龄按20，20-35，35这样分组（起别名）" class="headerlink" title="NBA球员年龄按20，20-35，35这样分组（起别名）#"></a>NBA球员年龄按20，20-35，35这样分组（起别名）<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#nba%E7%90%83%E5%91%98%E5%B9%B4%E9%BE%84%E6%8C%8920%EF%BC%8C20-35%EF%BC%8C35%E8%BF%99%E6%A0%B7%E5%88%86%E7%BB%84%EF%BC%88%E8%B5%B7%E5%88%AB%E5%90%8D%EF%BC%89">#</a></h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809212001240-1826680146.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809212001240-1826680146.png" alt="img"></a></p>
<h2 id="Date-Range-Aggregation时间范围分组聚合"><a href="#Date-Range-Aggregation时间范围分组聚合" class="headerlink" title="Date Range Aggregation时间范围分组聚合#"></a>Date Range Aggregation时间范围分组聚合<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#date-range-aggregation%E6%97%B6%E9%97%B4%E8%8C%83%E5%9B%B4%E5%88%86%E7%BB%84%E8%81%9A%E5%90%88">#</a></h2><h3 id="NBA球员按出生年月分组"><a href="#NBA球员按出生年月分组" class="headerlink" title="NBA球员按出生年月分组#"></a>NBA球员按出生年月分组<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#nba%E7%90%83%E5%91%98%E6%8C%89%E5%87%BA%E7%94%9F%E5%B9%B4%E6%9C%88%E5%88%86%E7%BB%84">#</a></h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809212226848-623388666.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809212226848-623388666.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;birthDayRange&quot;: &#123;</span><br><span class="line">      &quot;date_range&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;birthDay&quot;,</span><br><span class="line">        &quot;format&quot;: &quot;MM-yyy&quot;,</span><br><span class="line">        &quot;ranges&quot;: [</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;to&quot;: &quot;01-1989&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;from&quot;: &quot;01-1989&quot;,</span><br><span class="line">            &quot;to&quot;: &quot;01-1999&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;from&quot;: &quot;01-1999&quot;,</span><br><span class="line">            &quot;to&quot;: &quot;01-2009&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;from&quot;: &quot;01-2009&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Date-Histogram-Aggregation时间柱状图聚合"><a href="#Date-Histogram-Aggregation时间柱状图聚合" class="headerlink" title="Date Histogram Aggregation时间柱状图聚合#"></a>Date Histogram Aggregation时间柱状图聚合<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#date-histogram-aggregation%E6%97%B6%E9%97%B4%E6%9F%B1%E7%8A%B6%E5%9B%BE%E8%81%9A%E5%90%88">#</a></h2><h3 id="按天、月、年等进行聚合统计。可按year-1y-，quarter-1q-，month-1M-，week-1w-，day-1d-，hour-1h-，minute-1m-，second-1s-间隔聚合"><a href="#按天、月、年等进行聚合统计。可按year-1y-，quarter-1q-，month-1M-，week-1w-，day-1d-，hour-1h-，minute-1m-，second-1s-间隔聚合" class="headerlink" title="按天、月、年等进行聚合统计。可按year(1y)，quarter(1q)，month(1M)，week(1w)，day(1d)，hour(1h)，minute(1m)，second(1s)间隔聚合#"></a>按天、月、年等进行聚合统计。可按year(1y)，quarter(1q)，month(1M)，week(1w)，day(1d)，hour(1h)，minute(1m)，second(1s)间隔聚合<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E6%8C%89%E5%A4%A9%E3%80%81%E6%9C%88%E3%80%81%E5%B9%B4%E7%AD%89%E8%BF%9B%E8%A1%8C%E8%81%9A%E5%90%88%E7%BB%9F%E8%AE%A1%E3%80%82%E5%8F%AF%E6%8C%89year(1y)%EF%BC%8Cquarter(1q)%EF%BC%8Cmonth(1m)%EF%BC%8Cweek(1w)%EF%BC%8Cday(1d)%EF%BC%8Chour(1h)%EF%BC%8Cminute(1m)%EF%BC%8Csecond(1s)%E9%97%B4%E9%9A%94%E8%81%9A%E5%90%88">#</a></h3><h4 id="NBA球员按出生年分组"><a href="#NBA球员按出生年分组" class="headerlink" title="NBA球员按出生年分组"></a>NBA球员按出生年分组</h4><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809213028479-528280958.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809213028479-528280958.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;birthday_aggs&quot;: &#123;</span><br><span class="line">      &quot;date_histogram&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;birthDay&quot;,</span><br><span class="line">        &quot;format&quot;: &quot;yyyy&quot;,</span><br><span class="line">        &quot;interval&quot;: &quot;year&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809215134410-1469603574.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809215134410-1469603574.png" alt="img"></a></p>
<h1 id="ES之query-string查询"><a href="#ES之query-string查询" class="headerlink" title="ES之query_string查询#"></a>ES之query_string查询<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#es%E4%B9%8Bquery_string%E6%9F%A5%E8%AF%A2">#</a></h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介#"></a>简介<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E7%AE%80%E4%BB%8B">#</a></h2><p>　　query_string查询，如果熟悉lucene的查询语法，我们可以直接用lucene查询语法写一个查询串进行查询，ES中接到请求后，通过查询解析器，解析查询串生成对应的查询。</p>
<h2 id="指定单个字段查询"><a href="#指定单个字段查询" class="headerlink" title="指定单个字段查询#"></a>指定单个字段查询<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E6%8C%87%E5%AE%9A%E5%8D%95%E4%B8%AA%E5%AD%97%E6%AE%B5%E6%9F%A5%E8%AF%A2">#</a></h2><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809223148605-1718570790.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809223148605-1718570790.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123;</span><br><span class="line">      &quot;default_field&quot;: &quot;displayNameEn&quot;,</span><br><span class="line">      &quot;query&quot;: &quot;james OR curry&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;size&quot;: 100</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809223250770-296691656.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809223250770-296691656.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /nba/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123;</span><br><span class="line">      &quot;default_field&quot;: &quot;displayNameEn&quot;,</span><br><span class="line">      &quot;query&quot;: &quot;james AND harden&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;size&quot;: 100</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="指定多个字段查询"><a href="#指定多个字段查询" class="headerlink" title="指定多个字段查询#"></a>指定多个字段查询<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E6%8C%87%E5%AE%9A%E5%A4%9A%E4%B8%AA%E5%AD%97%E6%AE%B5%E6%9F%A5%E8%AF%A2">#</a></h2><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809223449266-1484554201.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809223449266-1484554201.png" alt="img"></a></p>
<h1 id="ElasticSearch的高级使用"><a href="#ElasticSearch的高级使用" class="headerlink" title="ElasticSearch的高级使用#"></a>ElasticSearch的高级使用<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#elasticsearch%E7%9A%84%E9%AB%98%E7%BA%A7%E4%BD%BF%E7%94%A8">#</a></h1><h2 id="别名有什么用"><a href="#别名有什么用" class="headerlink" title="别名有什么用#"></a>别名有什么用<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E5%88%AB%E5%90%8D%E6%9C%89%E4%BB%80%E4%B9%88%E7%94%A8">#</a></h2><p>　　在开发中，随着业务需求的迭代，较老的业务逻辑就要面临更新甚至是重构，而对于es来说，为了适应新的业务逻辑，可能就要对原有的索引做一些修改，比如对某字段做调整，甚至是重构索引。而做这些操作的时候，可能会对业务造成影响，甚至是停机调整等问题。由此，es提供了索引别名来解决这些问题。索引别名就像一个快捷方式或软连接，可以指向一个或多个索引，也可以给任意一个需要索引名的API来使用。别名的应用为程序提供了极大地灵活性。</p>
<h2 id="查询别名"><a href="#查询别名" class="headerlink" title="查询别名#"></a>查询别名<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E6%9F%A5%E8%AF%A2%E5%88%AB%E5%90%8D">#</a></h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /nba/_alias</span><br><span class="line"></span><br><span class="line">GET /_alias</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809232554566-1848711376.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809232554566-1848711376.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809232618543-1200367559.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809232618543-1200367559.png" alt="img"></a></p>
<h2 id="新增别名"><a href="#新增别名" class="headerlink" title="新增别名#"></a>新增别名<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E6%96%B0%E5%A2%9E%E5%88%AB%E5%90%8D">#</a></h2><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809232745066-2122500096.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809232745066-2122500096.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;nba&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;nba_v1.0&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809232832897-1793408238.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809232832897-1793408238.png" alt="img"></a></p>
<h2 id="删除别名"><a href="#删除别名" class="headerlink" title="删除别名#"></a>删除别名<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E5%88%A0%E9%99%A4%E5%88%AB%E5%90%8D">#</a></h2><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809232957736-1665117554.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809232957736-1665117554.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">方式一</span><br><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;remove&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;nba&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;nba_v1.0&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">方式二</span><br><span class="line">DELETE /nba/_alias/nba_v1.0</span><br></pre></td></tr></table></figure>



<h2 id="重命名别名"><a href="#重命名别名" class="headerlink" title="重命名别名#"></a>重命名别名<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E9%87%8D%E5%91%BD%E5%90%8D%E5%88%AB%E5%90%8D">#</a></h2><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809233351508-1228028649.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809233351508-1228028649.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;remove&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;nba&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;nba_v1.0&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;nba&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;nba_v2.0&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="为多个索引指定一个别名"><a href="#为多个索引指定一个别名" class="headerlink" title="为多个索引指定一个别名#"></a>为多个索引指定一个别名<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E4%B8%BA%E5%A4%9A%E4%B8%AA%E7%B4%A2%E5%BC%95%E6%8C%87%E5%AE%9A%E4%B8%80%E4%B8%AA%E5%88%AB%E5%90%8D">#</a></h2><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809233516578-198131973.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809233516578-198131973.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;nba&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;nba_v2.0&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,&#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;cba&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;cba_v2.0&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="为同个索引指定多个别名"><a href="#为同个索引指定多个别名" class="headerlink" title="为同个索引指定多个别名#"></a>为同个索引指定多个别名<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E4%B8%BA%E5%90%8C%E4%B8%AA%E7%B4%A2%E5%BC%95%E6%8C%87%E5%AE%9A%E5%A4%9A%E4%B8%AA%E5%88%AB%E5%90%8D">#</a></h2><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809233612128-1231594258.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809233612128-1231594258.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;nba&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;nba_v2.0&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,&#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;nba&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;cba_v2.2&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="通过别名读索引"><a href="#通过别名读索引" class="headerlink" title="通过别名读索引#"></a>通过别名读索引<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E9%80%9A%E8%BF%87%E5%88%AB%E5%90%8D%E8%AF%BB%E7%B4%A2%E5%BC%95">#</a></h2><h3 id="当别名指定了一个索引，则查出一个索引"><a href="#当别名指定了一个索引，则查出一个索引" class="headerlink" title="当别名指定了一个索引，则查出一个索引#"></a>当别名指定了一个索引，则查出一个索引<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E5%BD%93%E5%88%AB%E5%90%8D%E6%8C%87%E5%AE%9A%E4%BA%86%E4%B8%80%E4%B8%AA%E7%B4%A2%E5%BC%95%EF%BC%8C%E5%88%99%E6%9F%A5%E5%87%BA%E4%B8%80%E4%B8%AA%E7%B4%A2%E5%BC%95">#</a></h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809233759745-563557897.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809233759745-563557897.png" alt="img"></a></p>
<h3 id="当别名指定了多个索引，则查出多个索引"><a href="#当别名指定了多个索引，则查出多个索引" class="headerlink" title="当别名指定了多个索引，则查出多个索引#"></a>当别名指定了多个索引，则查出多个索引<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E5%BD%93%E5%88%AB%E5%90%8D%E6%8C%87%E5%AE%9A%E4%BA%86%E5%A4%9A%E4%B8%AA%E7%B4%A2%E5%BC%95%EF%BC%8C%E5%88%99%E6%9F%A5%E5%87%BA%E5%A4%9A%E4%B8%AA%E7%B4%A2%E5%BC%95">#</a></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /nba_v2.2</span><br></pre></td></tr></table></figure>

<h2 id="通过别名写索引"><a href="#通过别名写索引" class="headerlink" title="通过别名写索引#"></a>通过别名写索引<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E9%80%9A%E8%BF%87%E5%88%AB%E5%90%8D%E5%86%99%E7%B4%A2%E5%BC%95">#</a></h2><h3 id="当别名指定了一个索引，则可以做写的操作"><a href="#当别名指定了一个索引，则可以做写的操作" class="headerlink" title="当别名指定了一个索引，则可以做写的操作#"></a>当别名指定了一个索引，则可以做写的操作<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E5%BD%93%E5%88%AB%E5%90%8D%E6%8C%87%E5%AE%9A%E4%BA%86%E4%B8%80%E4%B8%AA%E7%B4%A2%E5%BC%95%EF%BC%8C%E5%88%99%E5%8F%AF%E4%BB%A5%E5%81%9A%E5%86%99%E7%9A%84%E6%93%8D%E4%BD%9C">#</a></h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809234120335-1705032346.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809234120335-1705032346.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /nba_v2.0/_doc/566</span><br><span class="line">&#123;</span><br><span class="line">  &quot;countryEn&quot;: &quot;Croatia&quot;,</span><br><span class="line">  &quot;teamName&quot;: &quot;快船&quot;,</span><br><span class="line">  &quot;birthDay&quot;: 858661200000,</span><br><span class="line">  &quot;country&quot;: &quot;克罗地亚&quot;,</span><br><span class="line">  &quot;teamCityEn&quot;: &quot;LA&quot;,</span><br><span class="line">  &quot;code&quot;: &quot;ivica_zubac&quot;,</span><br><span class="line">  &quot;displayAffiliation&quot;: &quot;Croatia&quot;,</span><br><span class="line">  &quot;displayName&quot;: &quot;伊维察 祖巴茨哥哥&quot;,</span><br><span class="line">  &quot;schoolType&quot;: &quot;&quot;,</span><br><span class="line">  &quot;teamConference&quot;: &quot;⻄部&quot;,</span><br><span class="line">  &quot;teamConferenceEn&quot;: &quot;Western&quot;,</span><br><span class="line">  &quot;weight&quot;: &quot;108.9 公⽄&quot;,</span><br><span class="line">  &quot;teamCity&quot;: &quot;洛杉矶&quot;,</span><br><span class="line">  &quot;playYear&quot;: 3,</span><br><span class="line">  &quot;jerseyNo&quot;: &quot;40&quot;,</span><br><span class="line">  &quot;teamNameEn&quot;: &quot;Clippers&quot;,</span><br><span class="line">  &quot;draft&quot;: 2016,</span><br><span class="line">  &quot;displayNameEn&quot;: &quot;Ivica Zubac&quot;,</span><br><span class="line">  &quot;heightValue&quot;: 2.16,</span><br><span class="line">  &quot;birthDayStr&quot;: &quot;1997-03-18&quot;,</span><br><span class="line">  &quot;position&quot;: &quot;中锋&quot;,</span><br><span class="line">  &quot;age&quot;: 22,</span><br><span class="line">  &quot;playerId&quot;: &quot;1627826&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="当别名指定了多个索引，可以指定写某个索引"><a href="#当别名指定了多个索引，可以指定写某个索引" class="headerlink" title="当别名指定了多个索引，可以指定写某个索引#"></a>当别名指定了多个索引，可以指定写某个索引<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E5%BD%93%E5%88%AB%E5%90%8D%E6%8C%87%E5%AE%9A%E4%BA%86%E5%A4%9A%E4%B8%AA%E7%B4%A2%E5%BC%95%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%8C%87%E5%AE%9A%E5%86%99%E6%9F%90%E4%B8%AA%E7%B4%A2%E5%BC%95">#</a></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;nba&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;national_player&quot;,</span><br><span class="line">        &quot;is_write_index&quot;: true</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;cba&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;national_player&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /national_player/_doc/566</span><br><span class="line">&#123;</span><br><span class="line">  &quot;countryEn&quot;: &quot;Croatia&quot;,</span><br><span class="line">  &quot;teamName&quot;: &quot;快船&quot;,</span><br><span class="line">  &quot;birthDay&quot;: 858661200000,</span><br><span class="line">  &quot;country&quot;: &quot;克罗地亚&quot;,</span><br><span class="line">  &quot;teamCityEn&quot;: &quot;LA&quot;,</span><br><span class="line">  &quot;code&quot;: &quot;ivica_zubac&quot;,</span><br><span class="line">  &quot;displayAffiliation&quot;: &quot;Croatia&quot;,</span><br><span class="line">  &quot;displayName&quot;: &quot;伊维察 祖巴茨妹妹&quot;,</span><br><span class="line">  &quot;schoolType&quot;: &quot;&quot;,</span><br><span class="line">  &quot;teamConference&quot;: &quot;⻄部&quot;,</span><br><span class="line">  &quot;teamConferenceEn&quot;: &quot;Western&quot;,</span><br><span class="line">  &quot;weight&quot;: &quot;108.9 公⽄&quot;,</span><br><span class="line">  &quot;teamCity&quot;: &quot;洛杉矶&quot;,</span><br><span class="line">  &quot;playYear&quot;: 3,</span><br><span class="line">  &quot;jerseyNo&quot;: &quot;40&quot;,</span><br><span class="line">  &quot;teamNameEn&quot;: &quot;Clippers&quot;,</span><br><span class="line">  &quot;draft&quot;: 2016,</span><br><span class="line">  &quot;displayNameEn&quot;: &quot;Ivica Zubac&quot;,</span><br><span class="line">  &quot;heightValue&quot;: 2.16,</span><br><span class="line">  &quot;birthDayStr&quot;: &quot;1997-03-18&quot;,</span><br><span class="line">  &quot;position&quot;: &quot;中锋&quot;,</span><br><span class="line">  &quot;age&quot;: 22,</span><br><span class="line">  &quot;playerId&quot;: &quot;1627826&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="ES之重建索引"><a href="#ES之重建索引" class="headerlink" title="ES之重建索引#"></a>ES之重建索引<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#es%E4%B9%8B%E9%87%8D%E5%BB%BA%E7%B4%A2%E5%BC%95">#</a></h1><h2 id="简介-1"><a href="#简介-1" class="headerlink" title="简介#"></a>简介<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E7%AE%80%E4%BB%8B">#</a></h2><p>　　ElasticSearch是一个实时的分布式搜索引擎，为用户提供搜索服务，当我们决定存储某种数据时，在创建索引的时候需要将数据结构完整确定下来，于此同时索引的设定和很多固定配置将不能修改。当需要改变数据结构时，就需要重新建立索引，为此，Elastic团队提供了很多辅助工具帮助开发人员进行重建索引</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤#"></a>步骤<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E6%AD%A5%E9%AA%A4">#</a></h2><ol>
<li>nba取一个别名nba_latest，nba_latest作为对外使用</li>
<li>新增一个索引nba_20200810，结构复制于nba索引，根据业务要求修改字段</li>
<li>将nba数据同步至nba_20200810</li>
<li>给nba_20200810添加别名nba_latest，删除此处nba别名nba_latest</li>
<li>删除nba索引</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809234950341-203091707.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809234950341-203091707.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PUT /nba_20220810</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;age&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;birthDay&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;date&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;birthDayStr&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;code&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;country&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;countryEn&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;displayAffiliation&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;displayName&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;displayNameEn&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;draft&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;long&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;heightValue&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;float&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;jerseyNo&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;playYear&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;long&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;playerId&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;position&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;schoolType&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;teamCity&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;teamCityEn&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;teamConference&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;teamConferenceEn&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;teamName&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;teamNameEn&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;weight&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="将旧索引数据copy到新索引"><a href="#将旧索引数据copy到新索引" class="headerlink" title="将旧索引数据copy到新索引#"></a>将旧索引数据copy到新索引<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E5%B0%86%E6%97%A7%E7%B4%A2%E5%BC%95%E6%95%B0%E6%8D%AEcopy%E5%88%B0%E6%96%B0%E7%B4%A2%E5%BC%95">#</a></h3><h4 id="同步等待，接口将会在reindex结束后返回"><a href="#同步等待，接口将会在reindex结束后返回" class="headerlink" title="同步等待，接口将会在reindex结束后返回"></a>同步等待，接口将会在reindex结束后返回</h4><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809235130171-772660654.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809235130171-772660654.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /_reindex</span><br><span class="line">&#123;</span><br><span class="line">  &quot;source&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &quot;nba&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;dest&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &quot;nba_20220810&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="异步执行，如果reindex时间过长，建议加上“wait-for-completion-x3D-false”的参数条件，这样reindex将直接返回taskId"><a href="#异步执行，如果reindex时间过长，建议加上“wait-for-completion-x3D-false”的参数条件，这样reindex将直接返回taskId" class="headerlink" title="异步执行，如果reindex时间过长，建议加上“wait_for_completion&#x3D;false”的参数条件，这样reindex将直接返回taskId"></a>异步执行，如果reindex时间过长，建议加上“wait_for_completion&#x3D;false”的参数条件，这样reindex将直接返回taskId</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /_reindex?wait_for_completion=false</span><br><span class="line">&#123;</span><br><span class="line">  &quot;source&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &quot;nba&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;dest&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &quot;nba_20220810&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="替换别名"><a href="#替换别名" class="headerlink" title="替换别名#"></a>替换别名<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E6%9B%BF%E6%8D%A2%E5%88%AB%E5%90%8D">#</a></h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809235344011-569506869.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809235344011-569506869.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;nba_20220810&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;nba_latest&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;remove&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;nba&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;nba_latest&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="删除旧索引"><a href="#删除旧索引" class="headerlink" title="删除旧索引#"></a>删除旧索引<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E5%88%A0%E9%99%A4%E6%97%A7%E7%B4%A2%E5%BC%95">#</a></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DELETE /nba</span><br></pre></td></tr></table></figure>

<h3 id="通过别名访问新索引"><a href="#通过别名访问新索引" class="headerlink" title="通过别名访问新索引#"></a>通过别名访问新索引<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E9%80%9A%E8%BF%87%E5%88%AB%E5%90%8D%E8%AE%BF%E9%97%AE%E6%96%B0%E7%B4%A2%E5%BC%95">#</a></h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809235451484-315656207.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200809235451484-315656207.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /nba_latest/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;displayNameEn&quot;: &quot;james&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="ES之refresh操作"><a href="#ES之refresh操作" class="headerlink" title="ES之refresh操作#"></a>ES之refresh操作<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#es%E4%B9%8Brefresh%E6%93%8D%E4%BD%9C">#</a></h1><h2 id="理想的搜索"><a href="#理想的搜索" class="headerlink" title="理想的搜索#"></a>理想的搜索<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E7%90%86%E6%83%B3%E7%9A%84%E6%90%9C%E7%B4%A2">#</a></h2><p>　　新的数据一添加到索引中立马就能搜索到，但是真实情况不是这样的</p>
<p>我们使用链式命令请求，先添加一个文档，再立刻搜索</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -X PUT 192.168.199.170:9200/star/_doc/888 -H &#x27;Content-Type:</span><br><span class="line">application/json&#x27; -d &#x27;&#123; &quot;displayName&quot;: &quot;蔡徐坤&quot; &#125;&#x27;</span><br><span class="line">curl -X GET localhost:9200/star/_doc/_search?pretty</span><br></pre></td></tr></table></figure>

<p>强制刷新</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -X PUT 192.168.199.170:9200/star/_doc/666?refresh -H &#x27;Content-Type:</span><br><span class="line">application/json&#x27; -d &#x27;&#123; &quot;displayName&quot;: &quot;杨超越&quot; &#125;&#x27;</span><br><span class="line">curl -X GET localhost:9200/star/_doc/_search?pretty</span><br></pre></td></tr></table></figure>

<p>修改默认更新时间（默认时间是1s）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PUT /star/_settings</span><br><span class="line">&#123;</span><br><span class="line">  &quot;index&quot;: &#123;</span><br><span class="line">    &quot;refresh_interval&quot;: &quot;5s&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>将refresh关闭</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PUT /star/_settings</span><br><span class="line">&#123;</span><br><span class="line">  &quot;index&quot;: &#123;</span><br><span class="line">    &quot;refresh_interval&quot;: &quot;-1&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="ES之高亮查询"><a href="#ES之高亮查询" class="headerlink" title="ES之高亮查询#"></a>ES之高亮查询<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#es%E4%B9%8B%E9%AB%98%E4%BA%AE%E6%9F%A5%E8%AF%A2">#</a></h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言#"></a>前言<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E5%89%8D%E8%A8%80">#</a></h2><p>　　如果<strong>返回的结果集中</strong>很多<strong>符合条件</strong>的结果，那<strong>怎么能一眼就能看到我们想要的那个结果呢</strong>？比如下面网站所示的那样，我们搜索“科比”，在结果集中，将所有“科比”高亮显示？</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200810001155235-797207731.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200810001155235-797207731.png" alt="img"></a></p>
<h2 id="高亮查询"><a href="#高亮查询" class="headerlink" title="高亮查询#"></a>高亮查询<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E9%AB%98%E4%BA%AE%E6%9F%A5%E8%AF%A2">#</a></h2><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200810001257836-1765935835.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200810001257836-1765935835.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /nba_latest/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;displayNameEn&quot;: &quot;james&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;displayNameEn&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="自定义高亮查询"><a href="#自定义高亮查询" class="headerlink" title="自定义高亮查询#"></a>自定义高亮查询<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AB%98%E4%BA%AE%E6%9F%A5%E8%AF%A2">#</a></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /nba_latest/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;displayNameEn&quot;: &quot;james&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;displayNameEn&quot;: &#123;</span><br><span class="line">        &quot;pre_tags&quot;: [</span><br><span class="line">          &quot;&lt;h1&gt;&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;post_tags&quot;: [</span><br><span class="line">          &quot;&lt;/h1&gt;&quot;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="ES之查询建议"><a href="#ES之查询建议" class="headerlink" title="ES之查询建议#"></a>ES之查询建议<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#es%E4%B9%8B%E6%9F%A5%E8%AF%A2%E5%BB%BA%E8%AE%AE">#</a></h1><h2 id="查询建议是什么"><a href="#查询建议是什么" class="headerlink" title="查询建议是什么#"></a>查询建议是什么<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E6%9F%A5%E8%AF%A2%E5%BB%BA%E8%AE%AE%E6%98%AF%E4%BB%80%E4%B9%88">#</a></h2><p>　　查询建议：是为了给用户提供更好的搜索体验。包括：词条检查，自动补全</p>
<h2 id="词条检查"><a href="#词条检查" class="headerlink" title="词条检查#"></a>词条检查<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E8%AF%8D%E6%9D%A1%E6%A3%80%E6%9F%A5">#</a></h2><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200810001609379-627439629.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200810001609379-627439629.png" alt="img"></a></p>
<h2 id="自动补全"><a href="#自动补全" class="headerlink" title="自动补全#"></a>自动补全<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8">#</a></h2><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200810001641260-2010858317.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img2020.cnblogs.com/blog/1504448/202008/1504448-20200810001641260-2010858317.png" alt="img"></a></p>
<h2 id="Suggester"><a href="#Suggester" class="headerlink" title="Suggester#"></a>Suggester<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#suggester">#</a></h2><ul>
<li>Term suggester</li>
<li>Phrase suggester</li>
<li>Completion suggester</li>
</ul>
<h2 id="字段"><a href="#字段" class="headerlink" title="字段#"></a>字段<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#%E5%AD%97%E6%AE%B5">#</a></h2><table>
<thead>
<tr>
<th>text</th>
<th>指定搜索文本</th>
</tr>
</thead>
<tbody><tr>
<td>field</td>
<td>获取建议词的搜索字段</td>
</tr>
<tr>
<td>analyzer</td>
<td>指定分词器</td>
</tr>
<tr>
<td>size</td>
<td>每个词返回的最大建议词数</td>
</tr>
<tr>
<td>sort</td>
<td>如何对建议词进行排序，可用选项：score：先按评分排序、再按文档频率排、term顺序frequency：先按文档频率排，再按评分，term顺序排</td>
</tr>
<tr>
<td>suggest_mode</td>
<td>建议模式，控制提供建议词的方式：missing：仅在搜索的词项在索引中不存在时才提供建议词，默认值；popular：仅建议文档频率比搜索词项高的词always：总是提供匹配的建议词</td>
</tr>
</tbody></table>
<h2 id="Term-Suggester"><a href="#Term-Suggester" class="headerlink" title="Term Suggester#"></a>Term Suggester<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#term-suggester">#</a></h2><p>　　term词条建议器，对给输入的文本进行分词，为每个分词提供词项建议</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /nba_latest/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;suggest&quot;: &#123;</span><br><span class="line">    &quot;my-suggestion&quot;: &#123;</span><br><span class="line">      &quot;text&quot;: &quot;jamse hardne&quot;,</span><br><span class="line">      &quot;term&quot;: &#123;</span><br><span class="line">        &quot;suggest_mode&quot;: &quot;missing&quot;,</span><br><span class="line">        &quot;field&quot;: &quot;displayNameEn&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Phrase-suggester"><a href="#Phrase-suggester" class="headerlink" title="Phrase suggester#"></a>Phrase suggester<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenyanbin/p/13419497.html#phrase-suggester">#</a></h2><p>　　phrase短语建议，在term的基础上，会考量多个term之间的关系，比如是否同时出现在索引的原文里，相邻成都，以及词频等</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /nba_latest/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;suggest&quot;: &#123;</span><br><span class="line">    &quot;my-suggestion&quot;: &#123;</span><br><span class="line">      &quot;text&quot;: &quot;jamse harden&quot;,</span><br><span class="line">      &quot;phrase&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;displayNameEn&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">郑东辉</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/09/01/es%E8%AF%A6%E8%A7%A3/">http://example.com/2024/09/01/es%E8%AF%A6%E8%A7%A3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">郑东辉的博客网站</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/elasticesarch/">elasticesarch</a></div><div class="post_share"><div class="social-share" data-image="https://tse4-mm.cn.bing.net/th/id/OIP-C.JIiB0z5a-wUWnqs2EgK_QgHaEK?rs=1&amp;pid=ImgDetMain" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2024/08/31/resilience4j%20ratelimiter%E9%99%90%E6%B5%81/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img.zcool.cn/community/0147435a123c52a80121985cfd8506.jpg@1280w_1l_2o_100sh.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">resilience4j ratelimiter限流</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/02/18/elasticsearch%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/" title="elasticsearch增删改查"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://wallpaperm.cmcm.com/9cc01ff1758b776d7f5c2b91295b982b.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-18</div><div class="title">elasticsearch增删改查</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/img/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">郑东辉</div><div class="author-info__description">生活没有投机取巧，不一定要比别人好，但一定要比以前好</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">44</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div><a id="card-info-btn" href="/about/"><i class="fab fa-github"></i><span>关于我</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE"><span class="toc-number">1.</span> <span class="toc-text">非结构化数据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A1%BA%E5%BA%8F%E6%89%AB%E6%8F%8F%E6%B3%95"><span class="toc-number">1.1.</span> <span class="toc-text">顺序扫描法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2"><span class="toc-number">1.2.</span> <span class="toc-text">全文搜索</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E"><span class="toc-number">2.</span> <span class="toc-text">什么是全文搜索引擎</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E"><span class="toc-number">3.</span> <span class="toc-text">常见的搜索引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Lucene"><span class="toc-number">3.1.</span> <span class="toc-text">Lucene</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Solr"><span class="toc-number">3.2.</span> <span class="toc-text">Solr</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ElasticSearch"><span class="toc-number">4.</span> <span class="toc-text">ElasticSearch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">5.</span> <span class="toc-text">核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95-index"><span class="toc-number">5.1.</span> <span class="toc-text">索引(index)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B-type"><span class="toc-number">5.2.</span> <span class="toc-text">类型(type)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%98%A0%E5%B0%84-mapping"><span class="toc-number">5.3.</span> <span class="toc-text">映射(mapping)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%87%E6%A1%A3-document"><span class="toc-number">5.4.</span> <span class="toc-text">文档(document)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%97%E6%AE%B5-field"><span class="toc-number">5.5.</span> <span class="toc-text">字段(field)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4-cluster"><span class="toc-number">5.6.</span> <span class="toc-text">集群(cluster)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8A%82%E7%82%B9-node"><span class="toc-number">5.7.</span> <span class="toc-text">节点(node)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E7%89%87%E5%92%8C%E5%89%AF%E6%9C%AC-shard"><span class="toc-number">5.8.</span> <span class="toc-text">分片和副本(shard)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RESTful%E9%A3%8E%E6%A0%BC%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="toc-number">6.</span> <span class="toc-text">RESTful风格的介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">6.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E6%B3%95"><span class="toc-number">6.2.</span> <span class="toc-text">方法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7"><span class="toc-number">7.</span> <span class="toc-text">调试工具</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Postman%E5%B7%A5%E5%85%B7-%E6%8E%A8%E8%8D%90"><span class="toc-number">7.1.</span> <span class="toc-text">Postman工具(推荐)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#curl%E5%B7%A5%E5%85%B7"><span class="toc-number">7.2.</span> <span class="toc-text">curl工具</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">8.</span> <span class="toc-text">索引的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E"><span class="toc-number">8.1.</span> <span class="toc-text">新增</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8D%95%E4%B8%AA%E8%8E%B7%E5%8F%96"><span class="toc-number">8.2.</span> <span class="toc-text">单个获取</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E8%8E%B7%E5%8F%96"><span class="toc-number">8.3.</span> <span class="toc-text">批量获取</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">8.4.</span> <span class="toc-text">删除</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89"><span class="toc-number">8.5.</span> <span class="toc-text">获取所有</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%80"><span class="toc-number">8.5.1.</span> <span class="toc-text">方式一</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%BA%8C"><span class="toc-number">8.5.2.</span> <span class="toc-text">方式二</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E7%B4%A2%E5%BC%95%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8-%E5%AD%98%E5%9C%A8%EF%BC%8C%E8%BF%94%E5%9B%9E200%EF%BC%8C%E4%B8%8D%E5%AD%98%E5%9C%A8404"><span class="toc-number">8.6.</span> <span class="toc-text">判断索引是否存在(存在，返回200，不存在404)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E7%B4%A2%E5%BC%95"><span class="toc-number">8.7.</span> <span class="toc-text">关闭索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E7%B4%A2%E5%BC%95"><span class="toc-number">8.8.</span> <span class="toc-text">打开索引</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">9.</span> <span class="toc-text">映射的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">9.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E-1"><span class="toc-number">9.2.</span> <span class="toc-text">新增</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#json%E6%A0%BC%E5%BC%8F"><span class="toc-number">9.3.</span> <span class="toc-text">json格式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96"><span class="toc-number">9.4.</span> <span class="toc-text">获取</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E8%8E%B7%E5%8F%96-1"><span class="toc-number">9.5.</span> <span class="toc-text">批量获取</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89mapping"><span class="toc-number">9.6.</span> <span class="toc-text">获取所有mapping</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%80-1"><span class="toc-number">9.6.1.</span> <span class="toc-text">方式一</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%BA%8C-1"><span class="toc-number">9.6.2.</span> <span class="toc-text">方式二</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E5%AD%97%E6%AE%B5"><span class="toc-number">9.7.</span> <span class="toc-text">添加一个字段</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">10.</span> <span class="toc-text">文档的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E-2"><span class="toc-number">10.1.</span> <span class="toc-text">新增</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8D%E6%8C%87%E5%AE%9Aid%E6%96%B9%E5%BC%8F%E6%96%B0%E5%A2%9E"><span class="toc-number">10.2.</span> <span class="toc-text">不指定id方式新增</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">10.3.</span> <span class="toc-text">自动创建索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E6%93%8D%E4%BD%9C%E7%B1%BB%E5%9E%8B"><span class="toc-number">10.4.</span> <span class="toc-text">指定操作类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E6%9F%A5%E7%9C%8B"><span class="toc-number">10.5.</span> <span class="toc-text">文档查看</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%A4%9A%E4%B8%AA%E6%96%87%E6%A1%A3"><span class="toc-number">10.6.</span> <span class="toc-text">查看多个文档</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%80-2"><span class="toc-number">10.6.1.</span> <span class="toc-text">方式一</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%BA%8C-2"><span class="toc-number">10.6.2.</span> <span class="toc-text">方式二</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%89"><span class="toc-number">10.6.3.</span> <span class="toc-text">方式三</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E5%9B%9B"><span class="toc-number">10.6.4.</span> <span class="toc-text">方式四</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9"><span class="toc-number">10.6.5.</span> <span class="toc-text">修改</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%91-source%E5%AD%97%E6%AE%B5%EF%BC%8C%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%B8%AA%E5%AD%97%E6%AE%B5"><span class="toc-number">10.7.</span> <span class="toc-text">向_source字段，增加一个字段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%8Esource%E5%AD%97%E6%AE%B5%EF%BC%8C%E5%88%A0%E9%99%A4%E4%B8%80%E4%B8%AA%E5%AD%97%E6%AE%B5"><span class="toc-number">10.8.</span> <span class="toc-text">从source字段，删除一个字段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E5%8F%82%E6%95%B0%E5%80%BC%EF%BC%8C%E6%9B%B4%E6%96%B0%E6%8C%87%E5%AE%9A%E6%96%87%E6%A1%A3%E7%9A%84%E5%AD%97%E6%AE%B5"><span class="toc-number">10.9.</span> <span class="toc-text">根据参数值，更新指定文档的字段</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">11.</span> <span class="toc-text">删除文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="toc-number">12.</span> <span class="toc-text">搜索的简单使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4nba%E7%B4%A2%E5%BC%95"><span class="toc-number">12.1.</span> <span class="toc-text">删除nba索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%B4%A2%E5%BC%95"><span class="toc-number">12.2.</span> <span class="toc-text">新建一个索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B0%E5%A2%9Edocument"><span class="toc-number">12.3.</span> <span class="toc-text">新增document</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%8D%E6%9D%A1%E6%9F%A5%E8%AF%A2-term"><span class="toc-number">13.</span> <span class="toc-text">词条查询(term)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8D%95%E6%9D%A1term%E6%9F%A5%E8%AF%A2"><span class="toc-number">13.1.</span> <span class="toc-text">单条term查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%9A%E6%9D%A1term%E6%9F%A5%E8%AF%A2"><span class="toc-number">13.2.</span> <span class="toc-text">多条term查询</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E6%96%87%E6%9F%A5%E8%AF%A2-full-text"><span class="toc-number">14.</span> <span class="toc-text">全文查询(full text)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#match-all"><span class="toc-number">14.1.</span> <span class="toc-text">match_all</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#match"><span class="toc-number">14.2.</span> <span class="toc-text">match</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#multi-match"><span class="toc-number">14.3.</span> <span class="toc-text">multi_match</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#match-phrase"><span class="toc-number">14.4.</span> <span class="toc-text">match_phrase</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#match-phrase-prefix"><span class="toc-number">14.5.</span> <span class="toc-text">match_phrase_prefix</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E8%AF%8D%E5%99%A8%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="toc-number"></span> <span class="toc-text">分词器的介绍和使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number"></span> <span class="toc-text">什么是分词器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E5%86%85%E7%BD%AE%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number"></span> <span class="toc-text">常用的内置分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#standard-analyzer"><span class="toc-number"></span> <span class="toc-text">standard analyzer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#simple-analyzer"><span class="toc-number"></span> <span class="toc-text">simple analyzer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#whitespace-analyzer"><span class="toc-number"></span> <span class="toc-text">whitespace analyzer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stop-analyzer"><span class="toc-number"></span> <span class="toc-text">stop analyzer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#language-analyzer"><span class="toc-number"></span> <span class="toc-text">language analyzer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pattern-analyzer"><span class="toc-number"></span> <span class="toc-text">pattern analyzer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number"></span> <span class="toc-text">选择分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">1.</span> <span class="toc-text">常见中文分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E7%9A%84%E5%88%86%E8%AF%8Dstandard"><span class="toc-number">1.1.</span> <span class="toc-text">默认的分词standard</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">1.2.</span> <span class="toc-text">常见分词器</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">常见的字段类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.1.</span> <span class="toc-text">数据类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.</span> <span class="toc-text">核心数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">2.2.1.</span> <span class="toc-text">字符串</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E5%9E%8B"><span class="toc-number">2.2.2.</span> <span class="toc-text">数值型</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%B8%83%E5%B0%94"><span class="toc-number">2.2.3.</span> <span class="toc-text">布尔</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6"><span class="toc-number">2.2.4.</span> <span class="toc-text">二进制</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.5.</span> <span class="toc-text">范围类型</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F-date"><span class="toc-number">2.2.6.</span> <span class="toc-text">日期-date</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.3.</span> <span class="toc-text">复杂数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B-Array"><span class="toc-number">2.3.1.</span> <span class="toc-text">数据类型 Array</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8BObject"><span class="toc-number">2.3.2.</span> <span class="toc-text">对象类型Object</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%93%E7%94%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.4.</span> <span class="toc-text">专用数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#IP%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.4.1.</span> <span class="toc-text">IP类型</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ES%E4%B9%8B%E6%89%B9%E9%87%8F%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">3.</span> <span class="toc-text">ES之批量导入数据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Bulk"><span class="toc-number">3.1.</span> <span class="toc-text">Bulk</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E5%AF%BC%E5%85%A5"><span class="toc-number">3.2.</span> <span class="toc-text">批量导入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#POST-bulk"><span class="toc-number">3.3.</span> <span class="toc-text">POST bulk</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ES%E4%B9%8Bterm%E7%9A%84%E5%A4%9A%E7%A7%8D%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.</span> <span class="toc-text">ES之term的多种查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-2"><span class="toc-number">4.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">4.2.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Term-query%E7%B2%BE%E5%87%86%E5%8C%B9%E9%85%8D%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.3.</span> <span class="toc-text">Term query精准匹配查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ES%E7%9A%84%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.4.</span> <span class="toc-text">ES的范围查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ES%E7%9A%84%E5%B8%83%E5%B0%94%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.5.</span> <span class="toc-text">ES的布尔查询</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.5.1.</span> <span class="toc-text">布尔查询</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#must-%E6%9F%A5%E8%AF%A2%E5%90%8D%E5%AD%97%E5%8F%AB%E5%81%9Ajames%E7%9A%84%E7%90%83%E5%91%98"><span class="toc-number">4.6.</span> <span class="toc-text">must(查询名字叫做james的球员)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%88%E6%9E%9C%E5%90%8Cmust%EF%BC%8C%E4%BD%86%E6%98%AF%E4%B8%8D%E6%89%93%E5%88%86-%E6%9F%A5%E6%89%BE%E5%90%8D%E5%AD%97%E5%8F%AB%E5%81%9Ajames%E7%9A%84%E7%90%83%E5%91%98"><span class="toc-number">4.7.</span> <span class="toc-text">效果同must，但是不打分(查找名字叫做james的球员)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#must-not%EF%BC%88%E6%9F%A5%E6%89%BE%E5%90%8D%E5%AD%97%E5%8F%AB%E5%81%9AJames%E7%9A%84%E8%A5%BF%E9%83%A8%E7%90%83%E5%91%98%EF%BC%89"><span class="toc-number">4.8.</span> <span class="toc-text">must_not（查找名字叫做James的西部球员）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#should%EF%BC%88%E6%9F%A5%E6%89%BE%E5%90%8D%E5%AD%97%E5%8F%AB%E5%81%9AJames%E7%9A%84%E6%89%93%E7%90%83%E6%97%B6%E9%97%B4%E5%BA%94%E8%AF%A5%E5%9C%A811%E5%88%B020%E5%B9%B4%E8%A5%BF%E9%83%A8%E7%90%83%E5%91%98%EF%BC%89"><span class="toc-number">4.9.</span> <span class="toc-text">should（查找名字叫做James的打球时间应该在11到20年西部球员）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ES%E7%9A%84%E6%8E%92%E5%BA%8F"><span class="toc-number">5.</span> <span class="toc-text">ES的排序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%81%AB%E7%AE%AD%E9%98%9F%E4%B8%AD%E6%8C%89%E6%89%93%E7%90%83%E6%97%B6%E9%97%B4%E4%BB%8E%E5%A4%A7%E5%88%B0%E5%B0%8F%E6%8E%92%E5%BA%8F%E7%9A%84%E7%90%83%E5%91%98"><span class="toc-number">5.1.</span> <span class="toc-text">火箭队中按打球时间从大到小排序的球员</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ES%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2%E4%B9%8B%E6%8C%87%E6%A0%87%E8%81%9A%E5%90%88"><span class="toc-number">6.</span> <span class="toc-text">ES聚合查询之指标聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ES%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">6.1.</span> <span class="toc-text">ES聚合查询是什么</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#max-min-sum-avg"><span class="toc-number">6.2.</span> <span class="toc-text">max min sum avg</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B1%82%E5%87%BA%E7%81%AB%E7%AE%AD%E9%98%9F%E7%90%83%E5%91%98%E7%9A%84%E5%B9%B3%E5%9D%87%E5%B9%B4%E9%BE%84"><span class="toc-number">6.2.1.</span> <span class="toc-text">求出火箭队球员的平均年龄</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#value-count%E7%BB%9F%E8%AE%A1%E9%9D%9E%E7%A9%BA%E5%AD%97%E6%AE%B5%E7%9A%84%E6%96%87%E6%A1%A3%E6%95%B0"><span class="toc-number">6.3.</span> <span class="toc-text">value_count统计非空字段的文档数</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B1%82%E5%87%BA%E7%81%AB%E7%AE%AD%E9%98%9F%E4%B8%AD%E7%90%83%E5%91%98%E6%89%93%E7%90%83%E6%97%B6%E9%97%B4%E4%B8%8D%E4%B8%BA%E7%A9%BA%E7%9A%84%E6%95%B0%E9%87%8F"><span class="toc-number">6.3.1.</span> <span class="toc-text">求出火箭队中球员打球时间不为空的数量</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E5%87%BA%E7%81%AB%E7%AE%AD%E9%98%9F%E6%9C%89%E5%A4%9A%E5%B0%91%E5%90%8D%E7%90%83%E5%91%98"><span class="toc-number">6.4.</span> <span class="toc-text">查出火箭队有多少名球员</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Cardinality%E5%80%BC%E5%8E%BB%E9%87%8D%E8%AE%A1%E6%95%B0"><span class="toc-number">6.5.</span> <span class="toc-text">Cardinality值去重计数</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9F%A5%E5%87%BA%E7%81%AB%E7%AE%AD%E9%98%9F%E4%B8%AD%E5%B9%B4%E9%BE%84%E4%B8%8D%E5%90%8C%E7%9A%84%E6%95%B0%E9%87%8F"><span class="toc-number">6.5.1.</span> <span class="toc-text">查出火箭队中年龄不同的数量</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stats%E7%BB%9F%E8%AE%A1count-max-min-avg-sum5%E4%B8%AA%E5%80%BC"><span class="toc-number"></span> <span class="toc-text">stats统计count max min avg sum5个值</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E5%87%BA%E7%81%AB%E7%AE%AD%E9%98%9F%E7%90%83%E5%91%98%E7%9A%84%E5%B9%B4%E9%BE%84stats"><span class="toc-number">1.</span> <span class="toc-text">查出火箭队球员的年龄stats</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ES%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2%E4%B9%8B%E6%A1%B6%E8%81%9A%E5%90%88"><span class="toc-number">2.</span> <span class="toc-text">ES聚合查询之桶聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ES%E8%81%9A%E5%90%88%E5%88%86%E6%9E%90%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">2.1.</span> <span class="toc-text">ES聚合分析是什么</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Terms-Aggregation%E6%A0%B9%E6%8D%AE%E5%AD%97%E6%AE%B5%E9%A1%B9%E5%88%86%E7%BB%84%E8%81%9A%E5%90%88"><span class="toc-number">2.2.</span> <span class="toc-text">Terms Aggregation根据字段项分组聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%81%AB%E7%AE%AD%E9%98%9F%E6%A0%B9%E6%8D%AE%E5%B9%B4%E9%BE%84%E8%BF%9B%E8%A1%8C%E5%88%86%E7%BB%84"><span class="toc-number">2.2.1.</span> <span class="toc-text">火箭队根据年龄进行分组</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Order%E5%88%86%E7%BB%84%E8%81%9A%E5%90%88%E6%8E%92%E5%BA%8F"><span class="toc-number">2.3.</span> <span class="toc-text">Order分组聚合排序</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%81%AB%E7%AE%AD%E9%98%9F%E6%A0%B9%E6%8D%AE%E5%B9%B4%E9%BE%84%E8%BF%9B%E8%A1%8C%E5%88%86%E7%BB%84%EF%BC%8C%E5%88%86%E7%BB%84%E4%BF%A1%E6%81%AF%E9%80%9A%E8%BF%87%E5%B9%B4%E9%BE%84%E4%BB%8E%E5%A4%A7%E5%88%B0%E5%B0%8F%E6%8E%92%E5%BA%8F%EF%BC%88%E9%80%9A%E8%BF%87%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5%EF%BC%89"><span class="toc-number">2.3.1.</span> <span class="toc-text">火箭队根据年龄进行分组，分组信息通过年龄从大到小排序（通过指定字段）</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%81%AB%E7%AE%AD%E9%98%9F%E6%A0%B9%E6%8D%AE%E5%B9%B4%E9%BE%84%E8%BF%9B%E8%A1%8C%E5%88%86%E7%BB%84%EF%BC%8C%E5%88%86%E7%BB%84%E4%BF%A1%E6%81%AF%E9%80%9A%E8%BF%87%E6%96%87%E6%A1%A3%E6%95%B0%E4%BB%8E%E5%A4%A7%E5%88%B0%E5%B0%8F%E6%8E%92%E5%BA%8F%EF%BC%88%E9%80%9A%E8%BF%87%E6%96%87%E6%A1%A3%E6%95%B0%EF%BC%89"><span class="toc-number">2.3.2.</span> <span class="toc-text">火箭队根据年龄进行分组，分组信息通过文档数从大到小排序（通过文档数）</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AF%8F%E6%94%AF%E7%90%83%E9%98%9F%E6%8C%89%E8%AF%A5%E9%98%9F%E6%89%80%E6%9C%89%E7%90%83%E5%91%98%E7%9A%84%E5%B9%B3%E5%9D%87%E5%B9%B4%E9%BE%84%E8%BF%9B%E8%A1%8C%E5%88%86%E7%BB%84%E6%8E%92%E5%BA%8F%EF%BC%88%E9%80%9A%E8%BF%87%E5%88%86%E7%BB%84%E6%8C%87%E6%A0%87%E5%80%BC%EF%BC%89"><span class="toc-number">2.4.</span> <span class="toc-text">每支球队按该队所有球员的平均年龄进行分组排序（通过分组指标值）</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AD%9B%E9%80%89%E5%88%86%E7%BB%84%E8%81%9A%E5%90%88"><span class="toc-number"></span> <span class="toc-text">筛选分组聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B9%96%E4%BA%BA%E5%92%8C%E7%81%AB%E7%AE%AD%E9%98%9F%E6%8C%89%E7%90%83%E9%98%9F%E5%B9%B3%E5%9D%87%E5%B9%B4%E9%BE%84%E8%BF%9B%E8%A1%8C%E5%88%86%E7%BB%84%E6%8E%92%E5%BA%8F%EF%BC%88%E6%8C%87%E5%AE%9A%E5%80%BC%E5%88%97%E8%A1%A8%EF%BC%89"><span class="toc-number"></span> <span class="toc-text">湖人和火箭队按球队平均年龄进行分组排序（指定值列表）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B9%96%E4%BA%BA%E5%92%8C%E7%81%AB%E7%AE%AD%E9%98%9F%E6%8C%89%E7%90%83%E9%98%9F%E5%B9%B3%E5%9D%87%E5%B9%B4%E9%BE%84%E8%BF%9B%E8%A1%8C%E5%88%86%E7%BB%84%E6%8E%92%E5%BA%8F%EF%BC%88%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8C%B9%E9%85%8D%E5%80%BC%EF%BC%89"><span class="toc-number"></span> <span class="toc-text">湖人和火箭队按球队平均年龄进行分组排序（正则表达式匹配值）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Range-Aggregation%E8%8C%83%E5%9B%B4%E5%88%86%E7%BB%84%E8%81%9A%E5%90%88"><span class="toc-number"></span> <span class="toc-text">Range Aggregation范围分组聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NBA%E7%90%83%E5%91%98%E5%B9%B4%E9%BE%84%E6%8C%8920%EF%BC%8C20-35%EF%BC%8C35%E8%BF%99%E6%A0%B7%E5%88%86%E7%BB%84"><span class="toc-number"></span> <span class="toc-text">NBA球员年龄按20，20-35，35这样分组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NBA%E7%90%83%E5%91%98%E5%B9%B4%E9%BE%84%E6%8C%8920%EF%BC%8C20-35%EF%BC%8C35%E8%BF%99%E6%A0%B7%E5%88%86%E7%BB%84%EF%BC%88%E8%B5%B7%E5%88%AB%E5%90%8D%EF%BC%89"><span class="toc-number"></span> <span class="toc-text">NBA球员年龄按20，20-35，35这样分组（起别名）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Date-Range-Aggregation%E6%97%B6%E9%97%B4%E8%8C%83%E5%9B%B4%E5%88%86%E7%BB%84%E8%81%9A%E5%90%88"><span class="toc-number"></span> <span class="toc-text">Date Range Aggregation时间范围分组聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NBA%E7%90%83%E5%91%98%E6%8C%89%E5%87%BA%E7%94%9F%E5%B9%B4%E6%9C%88%E5%88%86%E7%BB%84"><span class="toc-number"></span> <span class="toc-text">NBA球员按出生年月分组</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Date-Histogram-Aggregation%E6%97%B6%E9%97%B4%E6%9F%B1%E7%8A%B6%E5%9B%BE%E8%81%9A%E5%90%88"><span class="toc-number"></span> <span class="toc-text">Date Histogram Aggregation时间柱状图聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E5%A4%A9%E3%80%81%E6%9C%88%E3%80%81%E5%B9%B4%E7%AD%89%E8%BF%9B%E8%A1%8C%E8%81%9A%E5%90%88%E7%BB%9F%E8%AE%A1%E3%80%82%E5%8F%AF%E6%8C%89year-1y-%EF%BC%8Cquarter-1q-%EF%BC%8Cmonth-1M-%EF%BC%8Cweek-1w-%EF%BC%8Cday-1d-%EF%BC%8Chour-1h-%EF%BC%8Cminute-1m-%EF%BC%8Csecond-1s-%E9%97%B4%E9%9A%94%E8%81%9A%E5%90%88"><span class="toc-number"></span> <span class="toc-text">按天、月、年等进行聚合统计。可按year(1y)，quarter(1q)，month(1M)，week(1w)，day(1d)，hour(1h)，minute(1m)，second(1s)间隔聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#NBA%E7%90%83%E5%91%98%E6%8C%89%E5%87%BA%E7%94%9F%E5%B9%B4%E5%88%86%E7%BB%84"><span class="toc-number">1.</span> <span class="toc-text">NBA球员按出生年分组</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ES%E4%B9%8Bquery-string%E6%9F%A5%E8%AF%A2"><span class="toc-number"></span> <span class="toc-text">ES之query_string查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number"></span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%8D%95%E4%B8%AA%E5%AD%97%E6%AE%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number"></span> <span class="toc-text">指定单个字段查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%A4%9A%E4%B8%AA%E5%AD%97%E6%AE%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number"></span> <span class="toc-text">指定多个字段查询</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ElasticSearch%E7%9A%84%E9%AB%98%E7%BA%A7%E4%BD%BF%E7%94%A8"><span class="toc-number"></span> <span class="toc-text">ElasticSearch的高级使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%AB%E5%90%8D%E6%9C%89%E4%BB%80%E4%B9%88%E7%94%A8"><span class="toc-number"></span> <span class="toc-text">别名有什么用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%88%AB%E5%90%8D"><span class="toc-number"></span> <span class="toc-text">查询别名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%88%AB%E5%90%8D"><span class="toc-number"></span> <span class="toc-text">新增别名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%88%AB%E5%90%8D"><span class="toc-number"></span> <span class="toc-text">删除别名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D%E5%88%AB%E5%90%8D"><span class="toc-number"></span> <span class="toc-text">重命名别名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E5%A4%9A%E4%B8%AA%E7%B4%A2%E5%BC%95%E6%8C%87%E5%AE%9A%E4%B8%80%E4%B8%AA%E5%88%AB%E5%90%8D"><span class="toc-number"></span> <span class="toc-text">为多个索引指定一个别名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E5%90%8C%E4%B8%AA%E7%B4%A2%E5%BC%95%E6%8C%87%E5%AE%9A%E5%A4%9A%E4%B8%AA%E5%88%AB%E5%90%8D"><span class="toc-number"></span> <span class="toc-text">为同个索引指定多个别名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%88%AB%E5%90%8D%E8%AF%BB%E7%B4%A2%E5%BC%95"><span class="toc-number"></span> <span class="toc-text">通过别名读索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%93%E5%88%AB%E5%90%8D%E6%8C%87%E5%AE%9A%E4%BA%86%E4%B8%80%E4%B8%AA%E7%B4%A2%E5%BC%95%EF%BC%8C%E5%88%99%E6%9F%A5%E5%87%BA%E4%B8%80%E4%B8%AA%E7%B4%A2%E5%BC%95"><span class="toc-number"></span> <span class="toc-text">当别名指定了一个索引，则查出一个索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%93%E5%88%AB%E5%90%8D%E6%8C%87%E5%AE%9A%E4%BA%86%E5%A4%9A%E4%B8%AA%E7%B4%A2%E5%BC%95%EF%BC%8C%E5%88%99%E6%9F%A5%E5%87%BA%E5%A4%9A%E4%B8%AA%E7%B4%A2%E5%BC%95"><span class="toc-number"></span> <span class="toc-text">当别名指定了多个索引，则查出多个索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%88%AB%E5%90%8D%E5%86%99%E7%B4%A2%E5%BC%95"><span class="toc-number"></span> <span class="toc-text">通过别名写索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%93%E5%88%AB%E5%90%8D%E6%8C%87%E5%AE%9A%E4%BA%86%E4%B8%80%E4%B8%AA%E7%B4%A2%E5%BC%95%EF%BC%8C%E5%88%99%E5%8F%AF%E4%BB%A5%E5%81%9A%E5%86%99%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number"></span> <span class="toc-text">当别名指定了一个索引，则可以做写的操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%93%E5%88%AB%E5%90%8D%E6%8C%87%E5%AE%9A%E4%BA%86%E5%A4%9A%E4%B8%AA%E7%B4%A2%E5%BC%95%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%8C%87%E5%AE%9A%E5%86%99%E6%9F%90%E4%B8%AA%E7%B4%A2%E5%BC%95"><span class="toc-number"></span> <span class="toc-text">当别名指定了多个索引，可以指定写某个索引</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ES%E4%B9%8B%E9%87%8D%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number"></span> <span class="toc-text">ES之重建索引</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-1"><span class="toc-number"></span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4"><span class="toc-number"></span> <span class="toc-text">步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%97%A7%E7%B4%A2%E5%BC%95%E6%95%B0%E6%8D%AEcopy%E5%88%B0%E6%96%B0%E7%B4%A2%E5%BC%95"><span class="toc-number"></span> <span class="toc-text">将旧索引数据copy到新索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%E7%AD%89%E5%BE%85%EF%BC%8C%E6%8E%A5%E5%8F%A3%E5%B0%86%E4%BC%9A%E5%9C%A8reindex%E7%BB%93%E6%9D%9F%E5%90%8E%E8%BF%94%E5%9B%9E"><span class="toc-number">1.</span> <span class="toc-text">同步等待，接口将会在reindex结束后返回</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E6%89%A7%E8%A1%8C%EF%BC%8C%E5%A6%82%E6%9E%9Creindex%E6%97%B6%E9%97%B4%E8%BF%87%E9%95%BF%EF%BC%8C%E5%BB%BA%E8%AE%AE%E5%8A%A0%E4%B8%8A%E2%80%9Cwait-for-completion-x3D-false%E2%80%9D%E7%9A%84%E5%8F%82%E6%95%B0%E6%9D%A1%E4%BB%B6%EF%BC%8C%E8%BF%99%E6%A0%B7reindex%E5%B0%86%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9EtaskId"><span class="toc-number">2.</span> <span class="toc-text">异步执行，如果reindex时间过长，建议加上“wait_for_completion&#x3D;false”的参数条件，这样reindex将直接返回taskId</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2%E5%88%AB%E5%90%8D"><span class="toc-number"></span> <span class="toc-text">替换别名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%97%A7%E7%B4%A2%E5%BC%95"><span class="toc-number"></span> <span class="toc-text">删除旧索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%88%AB%E5%90%8D%E8%AE%BF%E9%97%AE%E6%96%B0%E7%B4%A2%E5%BC%95"><span class="toc-number"></span> <span class="toc-text">通过别名访问新索引</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ES%E4%B9%8Brefresh%E6%93%8D%E4%BD%9C"><span class="toc-number"></span> <span class="toc-text">ES之refresh操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%90%86%E6%83%B3%E7%9A%84%E6%90%9C%E7%B4%A2"><span class="toc-number"></span> <span class="toc-text">理想的搜索</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ES%E4%B9%8B%E9%AB%98%E4%BA%AE%E6%9F%A5%E8%AF%A2"><span class="toc-number"></span> <span class="toc-text">ES之高亮查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number"></span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E4%BA%AE%E6%9F%A5%E8%AF%A2"><span class="toc-number"></span> <span class="toc-text">高亮查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AB%98%E4%BA%AE%E6%9F%A5%E8%AF%A2"><span class="toc-number"></span> <span class="toc-text">自定义高亮查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ES%E4%B9%8B%E6%9F%A5%E8%AF%A2%E5%BB%BA%E8%AE%AE"><span class="toc-number"></span> <span class="toc-text">ES之查询建议</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%BB%BA%E8%AE%AE%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number"></span> <span class="toc-text">查询建议是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%8D%E6%9D%A1%E6%A3%80%E6%9F%A5"><span class="toc-number"></span> <span class="toc-text">词条检查</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8"><span class="toc-number"></span> <span class="toc-text">自动补全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Suggester"><span class="toc-number"></span> <span class="toc-text">Suggester</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E6%AE%B5"><span class="toc-number"></span> <span class="toc-text">字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Term-Suggester"><span class="toc-number"></span> <span class="toc-text">Term Suggester</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phrase-suggester"><span class="toc-number"></span> <span class="toc-text">Phrase suggester</span></a></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/09/01/es%E8%AF%A6%E8%A7%A3/" title="elasticsearch详解"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://tse4-mm.cn.bing.net/th/id/OIP-C.JIiB0z5a-wUWnqs2EgK_QgHaEK?rs=1&amp;pid=ImgDetMain" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="elasticsearch详解"/></a><div class="content"><a class="title" href="/2024/09/01/es%E8%AF%A6%E8%A7%A3/" title="elasticsearch详解">elasticsearch详解</a><time datetime="2024-09-01T01:00:32.255Z" title="发表于 2024-09-01 09:00:32">2024-09-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/31/resilience4j%20ratelimiter%E9%99%90%E6%B5%81/" title="resilience4j ratelimiter限流"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img.zcool.cn/community/0147435a123c52a80121985cfd8506.jpg@1280w_1l_2o_100sh.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="resilience4j ratelimiter限流"/></a><div class="content"><a class="title" href="/2024/08/31/resilience4j%20ratelimiter%E9%99%90%E6%B5%81/" title="resilience4j ratelimiter限流">resilience4j ratelimiter限流</a><time datetime="2024-08-31T02:43:26.638Z" title="发表于 2024-08-31 10:43:26">2024-08-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/19/resilience4j%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7%EF%BC%8C%E8%88%B1%E5%A3%81%E9%9A%94%E7%A6%BB/" title="resilience4j熔断降级，舱壁隔离"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://img.zcool.cn/community/01aa385dd0e509a8012053c054f060.jpg@2o.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="resilience4j熔断降级，舱壁隔离"/></a><div class="content"><a class="title" href="/2024/08/19/resilience4j%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7%EF%BC%8C%E8%88%B1%E5%A3%81%E9%9A%94%E7%A6%BB/" title="resilience4j熔断降级，舱壁隔离">resilience4j熔断降级，舱壁隔离</a><time datetime="2024-08-19T13:03:53.213Z" title="发表于 2024-08-19 21:03:53">2024-08-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/20/%E8%B0%83%E7%94%A8%E7%AC%AC%E4%B8%89%E6%94%BE%E6%B5%81%E5%BC%8F%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E%E6%B5%81%E5%BC%8F%E6%95%B0%E6%8D%AE(webclient%E6%96%B9%E5%BC%8F)/" title="调用第三方api流式接口返回流式数据(webclient+sse)"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://pic1.zhimg.com/v2-9db7bf3b825f2db103a534ca59c75481_r.jpg?source=1940ef5c" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="调用第三方api流式接口返回流式数据(webclient+sse)"/></a><div class="content"><a class="title" href="/2024/07/20/%E8%B0%83%E7%94%A8%E7%AC%AC%E4%B8%89%E6%94%BE%E6%B5%81%E5%BC%8F%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E%E6%B5%81%E5%BC%8F%E6%95%B0%E6%8D%AE(webclient%E6%96%B9%E5%BC%8F)/" title="调用第三方api流式接口返回流式数据(webclient+sse)">调用第三方api流式接口返回流式数据(webclient+sse)</a><time datetime="2024-07-20T02:56:09.968Z" title="发表于 2024-07-20 10:56:09">2024-07-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/16/%E8%B0%83%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9api%E6%B5%81%E5%BC%8F%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E%E6%B5%81%E5%BC%8F%E6%95%B0%E6%8D%AE/" title="调用第三方api流式接口返回流式数据(仿chatgpt)"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://pic.mac89.com/pic/202112/06114136_72df3bb8ce.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="调用第三方api流式接口返回流式数据(仿chatgpt)"/></a><div class="content"><a class="title" href="/2024/03/16/%E8%B0%83%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9api%E6%B5%81%E5%BC%8F%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E%E6%B5%81%E5%BC%8F%E6%95%B0%E6%8D%AE/" title="调用第三方api流式接口返回流式数据(仿chatgpt)">调用第三方api流式接口返回流式数据(仿chatgpt)</a><time datetime="2024-03-16T10:51:48.296Z" title="发表于 2024-03-16 18:51:48">2024-03-16</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script></div><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>