---
title: mysql事务
categories: mysql
tags:
  - mysql
excerpt: ''
cover: https://img-baofun.zhhainiao.com/fs/ddf3fd9609b877516dc4af85b6fa6668.jpg
---

#### 事务管理

- 原子性（A）：**事务开始后所有操作，要么全部完成，要么全部不完成，不可能停滞在中间环节**。事务执行过程中出错，会回滚（Rollback）到事务开始前的状态，所有的操作就像没有发生一样。也就是说事务是一个不可分割的整体。

- 一致性（C）：**事务开始前和结束后，数据库的完整性约束没有被破坏** 。比如A向B转账，不可能A扣了钱，B却没收到

- 隔离性（I）：同一时间，只允许一个事务请求同一数据，**不同的事务之间彼此没有任何干扰**。比如A正在从一张银行卡中取钱，在A取钱的过程结束前，B不能向这张卡转账

- 持久性（D）：**事务完成后，该事务所对数据库所作的更改将永久被保存到数据库之中**

#### 事务隔离级别

- 读未提交(READ_UNCOMMITTED)

- 读已提交(READ_COMMITTED)
- 可重复读(REPEATABLE_READ，mysql默认)：不会出现脏读，幻读，不可重复读情况
- 顺序读(SERIALIZABLE)

#### 事务并发引起的问题

- 脏读：一个事务读取了第二个事务未提交的数据，当第二个事务回滚了数据之后，第一个事务就读取到了无效的数据(读未提交的数据)
- 不可重复读：一个事务前后两次读取的同一数据不一致(读已提交的数据)
- 幻读：指一个事务两次查询的结果集记录数不一致(读已提交的数据)

![mysql事务隔离级别](/2022/09/19/mysql事务/mysql事务隔离级别.png)

#### 事务原理

事务开启后，所有的操作都会临时保存到事务日志，事务日志只有在得到commit命令才会同步到数据表，其他任何情况都会清空(rollback，断电，断开连接)

#### 回滚点

在某个成功的操作完成之后，后续的操作有可能成功，有可能失败，但是不管成功还是失败，前面的操作都已经成功；可以在当前位置，设置一个回滚点，可以供后续失败操作返回到该位置，而不是返回所有操作。

~~~mysql
start TRANSACTION;
insert into test2(username) values("aaa");
SAVEPOINT insert1;

insert into test2(username) values("bbb");
ROLLBACK;
~~~

